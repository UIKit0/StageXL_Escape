import "dart:json" as EJ;import "dart:math" as WB;import "dart:html" as lC;import "dart:web_audio" as uE;import "dart:async" as ZB;class NB{var uJ;var yJ;var CK;var EK;var MK;var RK;var UK;var WK;var aK;var eK;var iK;var nK;var pK;NB( i, j, h, g){uJ=i;yJ=j;CK=h;EK=g;MK=CB.WD;RK=-1000;UK=-1000;WK=false;aK=false;eK=false;iK=null;nK=null;pK=null;} get color=>CK; set color( g){CK=g;} get direction=>EK; set direction( g){EK=g;} get KB=>MK; set KB( g){MK=g;} get gB=>WK; set gB( g){WK=g;} get PC=>aK; set PC( g){aK=g;} get empty=>eK; set empty( g){eK=g;} tD( g){var h=g!=null&&(g.color==CK||g.KB==CB.SB||MK==CB.SB)&&g.KB!=CB.JC&&MK!=CB.JC;return h;} hC( g){var h=g!=null&&(g.color==CK||g.KB==CB.SB||MK==CB.SB)&&g.direction==0&&EK==0&&g.KB!=CB.JC&&MK!=CB.JC;return h;} tC( g){var h=g!=null&&(g.color==CK||g.KB==CB.SB||MK==CB.SB)&&g.direction==1&&EK==1&&g.KB!=CB.JC&&MK!=CB.JC;return h;} get x=>RK; set x( g){RK=g;if(iK!=null)iK.x=g;if(nK!=null)nK.x=g;if(pK!=null)pK.x=g;} get y=>UK; set y( g){UK=g;if(iK!=null)iK.y=g;if(nK!=null)nK.y=g;if(pK!=null)pK.y=g;} set VG( g){if(iK!=null){iK.kB=iK.rB=1+0.3*WB.sin(g*WB.PI);}} sB( g, h, i){if(iK!=null){iK.parent.HC(iK);iK=null;}if(nK!=null){nK.parent.HC(nK);nK=null;}if(pK!=null){pK.parent.HC(pK);pK=null;}if(empty==false){switch (MK){case CB.SB:iK=new GJ(uJ,yJ,EK);iK.x=RK;iK.y=UK;g.q(iK);break;case CB.JC:iK=tB.IE(uJ,CB.JC);iK.x=RK;iK.y=UK;g.q(iK);break;default:iK=tB.EE(uJ,CK,EK);iK.x=RK;iK.y=UK;g.q(iK);break;}if(WK){nK=aK?new IJ(uJ,yJ,EK):tB.fG(uJ,CK,EK);nK.x=RK+((EK==0)?25:0);nK.y=UK+((EK==1)?25:0);h.q(nK);}switch (MK){case CB.WD:break;case CB.JC:break;case CB.SB:break;default:pK=new HJ(uJ,yJ,MK);pK.x=RK;pK.y=UK;i.q(pK);break;}}}}class bG extends EB{var vJ;var xJ;var BK;var IK;var NK;bG( h, i){q(new JB(h.AB("InfoBox")));xJ=new LC();xJ.OC=new bD("Arial",35,0xFFFFFF,bold:true,align:DC.VC);xJ.width=220;xJ.height=40;xJ.wordWrap=false;xJ.text="Level 1";xJ.x=20;xJ.y=115;xJ.TB=-2*WB.PI/180;q(xJ);IK=new LC();IK.OC=new bD("Arial",25,0xFFFFFF,bold:true,align:DC.VC);IK.width=220;IK.height=30;IK.wordWrap=false;IK.text="40";IK.x=-IK.width/2;IK.y=-IK.height/2;IK.TB=-2*WB.PI/180;NK=new EB();NK.q(IK);NK.x=150;NK.y=172;q(NK);var g=tB.EE(h,3,0);g.x=110;g.y=171;g.TB=-2*WB.PI/180;g.kB=g.rB=0.6;q(g);} set dI( g){vJ=g;xJ.text="Level ${vJ}";} set xF( g){BK=g;IK.text="${BK}";}}class dG extends EB{var uJ;var yJ;var JK;var QK;var YK;dG( g, h){uJ=g;yJ=h;JK=tB.kG(uJ);QK=new JB(JK[0]);QK.x=-QK.width/2;QK.y=-QK.height/2;q(QK);YK=null;} NG( g){yJ.remove(YK);YK=new WC(0,g,0.5*g,QB.XC);YK.QC=(h){var i=((h*JK.length)%JK.length).toInt();QK.GC=JK[i];QK.y=WB.sin(h*2*WB.PI)*3-QK.height/2;};yJ.add(YK);} iI(){yJ.remove(YK);QK.GC=JK[0];}}class CB{static const  WD="None";static const  SB="Joker";static const  JC="Block";static const  zE="Double";static const  AF="Quint";}class FJ extends EB{var uJ;var yJ;var FK;var OK;var VK;var bK;var wJ;var hK;var jK;var lK;var oK;var vJ;var rK;var sK;var tK;var uK;var wK;var xK;var yK;var AL;var BL;FJ( k, l){uJ=k;yJ=l;var j=new JB(uJ.AB("ShuffleButtonNormal"));var i=new JB(uJ.AB("ShuffleButtonPressed"));OK=new vC(j,j,i,i);OK.OB(t.fC,UL);OK.x=530;OK.y=525;q(OK);var h=new JB(uJ.AB("ExitButtonNormal"));var g=new JB(uJ.AB("ExitButtonPressed"));VK=new vC(h,h,g,g);VK.OB(t.fC,WL);VK.x=700;VK.y=500;q(VK);FK=new bG(uJ,yJ);FK.x=540;FK.y=-1000;q(FK);wJ=new SE(10,uJ.AB("TimeGauge"),dD.VE);wJ.x=659;wJ.y=244;wJ.OB("TimeShort",YL);wJ.OB("TimeOver",RL);q(wJ);yJ.add(wJ);hK=new dG(uJ,yJ);hK.x=640;hK.y=230;q(hK);jK=new eG(uJ,yJ);jK.x=665;jK.y=160;q(jK);lK=new LC();lK.OC=new bD("Arial",30,0xD0D0D0,bold:true,align:DC.VC);lK.width=140;lK.height=36;lK.wordWrap=false;lK.x=646;lK.y=130;lK.UB=false;lK.text="0";lK.kB=0.9;q(lK);oK=new LC();oK.OC=new bD("Arial",20,0xFFFFFF,bold:true,align:DC.VC);oK.width=44;oK.height=30;oK.wordWrap=false;oK.x=610;oK.y=559;oK.UB=false;oK.text="3x";q(oK);wK=new EB();q(wK);xK=new EB();q(xK);yK=new EB();q(yK);AL=uJ.pB("Intro");BL=AL.play();} start(){vJ=1;rK=1;uK=0;sK=3;var g=new DE(uJ,yJ,uJ.ED("ESCStartText"));xK.q(g);yJ.jB(()=>hK.NG(21),1);g.show(()=>yJ.jB(()=>dL(),0.5));} dL(){if(bK!=null&&this.contains(bK))wK.HC(bK);var m=vJ;var g=0;var h=0;switch (vJ){case 01:h=50;bK=new cG(uJ,yJ,g=40,3,0,0,0,0,[0,1,2]);break;case 02:h=45;bK=new cG(uJ,yJ,g=45,3,1,0,0,0,[2,3,4]);break;case 03:h=40;bK=new cG(uJ,yJ,g=50,4,2,2,1,0,[5,6,7]);break;case 04:h=35;bK=new cG(uJ,yJ,g=55,4,3,3,2,0,[0,2,6]);break;case 05:h=30;bK=new cG(uJ,yJ,g=60,5,4,4,2,1,[1,3,5]);break;case 06:h=34;bK=new cG(uJ,yJ,g=60,5,5,5,3,2,[1,2,4,7]);break;case 07:h=33;bK=new cG(uJ,yJ,g=65,5,5,6,3,2,[0,1,2,3]);break;case 08:h=32;bK=new cG(uJ,yJ,g=70,5,5,6,3,2,[0,2,5,6]);break;case 09:h=31;bK=new cG(uJ,yJ,g=75,5,5,6,3,2,[1,4,5,7]);break;default:h=30;bK=new cG(uJ,yJ,g=80+(vJ-10)*5,5,5,6,3,2,[0,1,2,3]);break;}tK=g;if(sK<3){sK++ ;oK.text="${sK}x";}bK.OB(cB.xE,eL);bK.OB(cB.XD,fL);bK.OB(cB.yE,gL);bK.OB(cB.HE,hL);bK.x=20;bK.y=16;bK.UB=false;wK.q(bK);wJ.reset(h);wJ.oD("TimeShort",9);wJ.oD("TimeOver",0);wJ.pause();FK.dI=m;FK.xF=g;FK.y=-210;var k=new eB(FK,0.4,QB.FC);k.fB.y.bB(-90);yJ.add(k);var j=new DE(uJ,yJ,uJ.ED("ESCLevelBoxText").replaceAll("{0}","${g}"));xK.q(j);j.show((){bK.UB=true;wJ.start();if(AL!=null){var i=new WC(1.0,0.0,4.0,QB.XC);i.QC=(l){BL.MC.volume=l;BL.MC=BL.MC;};i.onComplete=(){BL.stop();hK.iI();};yJ.add(i);AL=null;}});} YL( g){jK.start();} RL( g){bK.YG(IC.GE);} fL( j){var g=0;var k=j.info["Position"];var h=j.info["Type"];if(h=="SingleLocked")g=3000;if(h=="SingleUnlocked")g=1000;if(h=="All")g=10000;var i=new vE(uJ,yJ,g);i.x=k.x;i.y=k.y;wK.q(i);uK=uK+g;lK.text="${uK}";} eL( j){var g=tK;var i=j.info["Length"];var k=j.info["Factor"];g=(g>i)?g-i:0;tK=g;FK.xF=g;if(g==0)bK.YG(IC.FE);var h=0;switch (i){case 3:h=1000;break;case 4:h=2000;break;case 5:h=5000;break;default:h=5000;break;}uK=uK+h*k;lK.text="${uK}";} gL( m){wJ.pause();jK.stop();var l=uJ.pB("Laugh");var k=uJ.pB("LevelUp");l.play();hK.NG(3);var g=tB.gG(uJ,yJ);g.x=55;g.y=260;wK.q(g);yJ.jB((){bK.DG();k.play();},2.0);yJ.jB((){var j=(wJ.tI*1000).toInt();var h=new vE(uJ,yJ,j);h.x=704;h.y=360;wK.q(h);uK=uK+j;lK.text="${uK}";},2.5);var i=new eB(FK,0.5,QB.FC);i.fB.y.bB(-210);i.aC=3.0;yJ.add(i);yJ.jB((){wK.HC(g);},3.5);yJ.jB((){vJ++ ;dL();},4.0);} hL( i){jK.stop();bK.DG();var g;if(rK>0){rK-- ;g=new DE(uJ,yJ,uJ.ED("GEN2ndchancetime"));xK.q(g);uJ.pB("LevelUp").play();g.show((){yJ.jB(()=>dL(),0.5);var h=new eB(FK,0.5,QB.FC);h.fB.y.bB(-210);yJ.add(h);});}else{g=new DE(uJ,yJ,uJ.ED("GENtimeup"));xK.q(g);uJ.pB("GameOver").play();g.show((){yJ.jB(()=>lL(),0.5);var h=new eB(FK,0.5,QB.FC);h.fB.y.bB(-210);yJ.add(h);});}} UL( h){if(bK!=null&&sK>0){var g=bK.UG();if(g){sK=sK-1;oK.text="${sK}x";}}} WL( j){var h=new EB();h.q(new JB(new DB(800,600,false,0x000000)));h.alpha=0.6;yK.q(h);var g=new aG(uJ,yJ);g.x=235;g.y=150;yK.q(g);g.show(( i){yK.HC(g);if(i==false)yK.HC(h);else nL(false);});}lL(){var h=new EB();var j=new JB(uJ.AB("ExitBox"));h.q(j);var g=new LC();g.OC=new bD("Arial",30,0xFFFFFF,bold:true,align:DC.VC);g.width=240;g.height=200;g.wordWrap=true;g.text=uJ.ED("GENgameover");g.x=47;g.y=30+(g.height-g.qE)/2;g.UB=false;h.q(g);h.x=110;h.y=-h.height;xK.q(h);yJ.jB(()=>uJ.pB("Laugh").play(),0.3);var i=new eB(h,0.3,QB.FC);i.fB.y.bB(150);yJ.add(i);yJ.jB(()=>nL(true),5.0);h.OB(t.fC,( k)=>nL(true));}var oL=false; nL( g){wJ.pause();if(oL==false){oL=true;}}}class HJ extends EB implements mB{var zJ;var DK;HJ( j, g, i){this.UB=false;DK=0.0;zJ=tB.IE(j,i);q(zJ);OB(BB.CD,(h)=>g.add(this));OB(BB.PD,(h)=>g.remove(this));} AC( g){DK+= g;this.TB=WB.sin(DK*7)*10*WB.PI/180;return true;}}class cG extends EB{var cK;var mK;var qK;var vK;var zK;var CL;var DL;var uJ;var yJ;var FL;var GL;var HL;var IL;var JL;var KL;var LL;var NL;var OL;var PL;var QL;var SL;var TL;cG( lB, n, v, s, RB, m, o, GB, k){uJ=lB;yJ=n;FL=new WB.Random();GL=IC.HD;HL=k;cK=v;mK=s;qK=RB;vK=m;zK=o;CL=GB;DL=k.length;LL=new List<LB>();OL=new EB();PL=new EB();QL=new EB();SL=new EB();TL=new EB();q(OL);q(PL);q(QL);q(SL);q(TL);PL.UB=false;QL.UB=false;SL.UB=false;TL.UB=false;aI();bI();ZI();NL=true;var l=new GD();this.mask=new JE.oJ(0.0,0.0,500.0,500.0);for(int i=0;i<10;i++ ){for(int g=0;g<10;g++ ){var h=JL[i+g*10];h.x=i*50+25;h.y=g*50+25-550;h.sB(OL,PL,QL);var j=new WC(h.y,g*50+25,0.4,QB.FC);j.aC=i*0.03;j.QC=(VB){h.y=VB;};j.onComplete=(){if(l.uD()==100){bL();NL=false;LL.clear();this.mask=null;}};yJ.add(j);}}OB(t.hD,cL);} YG( g){if(g==IC.FE){GL=g;}if(g==IC.GE&&GL==IC.HD){GL=g;if(NL==false)dispatchEvent(new cB(cB.HE,null));}} DG(){this.mask=new JE.oJ(0.0,0.0,500.0,500.0);for(int h=0;h<10;h++ ){for(int i=0;i<10;i++ ){var g=JL[i+h*10];g.gB=false;g.PC=false;g.KB=CB.WD;g.sB(OL,PL,QL);var j=new WC(g.y,500+h*50+25,0.5,QB.FC);j.aC=i*0.1;j.QC=(k){g.y=k;};yJ.add(j);}}} aI(){KL=new List<VD>();for(int h=0;h<mK;h++ ){var g=new VD(uJ,yJ,h);g.TB=(FL.nextInt(30)-15)*WB.PI/180;g.x=300-(90*mK)/2+h*90+FL.nextInt(20)-10;g.y=550;KL.add(g);SL.q(g);}} BG( g, h){var i=0;var j=JL[g+h*10];if(j.direction==0){var l=(g>0)?JL[g-1+h*10]:null;var m=(g<9)?JL[g+1+h*10]:null;if(j.hC(l))i++ ;if(j.hC(m))i++ ;}else{var k=(h>0)?JL[g+(h-1)*10]:null;var n=(h<9)?JL[g+(h+1)*10]:null;if(j.tC(k))i++ ;if(j.tC(n))i++ ;}return i;} zF(){for(int h=0;h<10;h++ ){for(int g=0;g<10;g++ ){var k=JL[g+h*10];var i=DL*2;while (BG(g,h)==2&&i>0){if(i%2==0){k.direction=1-k.direction;i-- ;}else{var m=0;for(int j=0;j<HL.length;j++ )if(k.color==HL[j])m=j;k.color=HL[(m+1)%HL.length];i-- ;}}}}var l=false;for(int h=0;h<10;h++ ){for(int g=0;g<10;g++ ){l=l||(BG(g,h)==2);}}return l;} PG(){for(int g=0;g<10;g++ )for(int h=1;h<9;h++ )if(JL[(h-1)+g*10].tD(JL[h+g*10])&&JL[h+g*10].tD(JL[(h+1)+g*10]))return true;for(int h=0;h<10;h++ )for(int g=1;g<9;g++ )if(JL[h+(g-1)*10].tD(JL[h+g*10])&&JL[h+g*10].tD(JL[h+(g+1)*10]))return true;return false;} iL( j, l, k){for(int g=0;g<20;g++ ){var h=cK~/k;var i=l*h+FL.nextInt(h);if(IL[i].KB==CB.WD){IL[i].KB=j;return;}}} bI(){IL=new List<NB>();for(int g=0;g<cK;g++ ){var i=HL[FL.nextInt(HL.length)];var h=FL.nextInt(2);IL.add(new NB(uJ,yJ,i,h));}for(int g=0;g<mK*2;g++ )iL("Lock${(g%mK)+1}",g,mK*2);for(int g=0;g<qK;g++ )iL(CB.SB,g,qK);for(int g=0;g<vK;g++ )iL(CB.JC,g,vK);for(int g=0;g<zK;g++ )iL(CB.zE,g,zK);for(int g=0;g<CL;g++ )iL(CB.AF,g,CL);} ZI(){JL=new List<NB>();var g=true;while (g){JL.clear();for(int h=0;h<100;h++ ){var j=HL[FL.nextInt(HL.length)];var i=FL.nextInt(2);JL.add(new NB(uJ,yJ,j,i));}g=zF();}} UG(){if(NL||GL!=IC.HD)return false;var l=true;NL=true;while (l){for(int k=0;k<JL.length;k++ ){var g=JL[k];g.gB=false;g.PC=false;g.sB(OL,PL,QL);g.color=HL[FL.nextInt(HL.length)];g.direction=FL.nextInt(2);}l=zF()||(PG()==false);}uJ.pB("BonusUniversal").play();var m=new GD();for(int i=0;i<10;i++ ){for(int j=0;j<10;j++ ){var g=JL[i+j*10];g.VG=0.0;var h=new WC(0.0,1.0,0.2,QB.XC);h.aC=i*0.06;h.QC=(n){g.VG=n;};h.onStart=(){g.sB(OL,PL,QL);};h.onComplete=(){if(m.uD()==100){bL();jL();LL.clear();}};yJ.add(h);}}return true;} bL(){for(int i=0;i<10;i++ ){for(int h=0;h<10;h++ ){var g=JL[h+i*10];var l=(h<9)?JL[h+1+i*10]:null;var m=(i<9)?JL[h+(i+1)*10]:null;var j=false;var k=false;if(g.hC(l)){j=true;k=(g.KB==CB.SB||l.KB==CB.SB);}if(g.tC(m)){j=true;k=(g.KB==CB.SB||m.KB==CB.SB);}if(g.gB!=j||g.PC!=k){g.gB=j;g.PC=k;g.sB(OL,PL,QL);}}}} kL( s, l, n, k, m, o){NL=true;s.uD(k);var i=1;for(int g=0;g<k;g++ ){var h=JL[l+g*m+(n+g*o)*10];if(h.KB==CB.zE)i=i*2;if(h.KB==CB.AF)i=i*5;var v=l+g*m;var GB=n+g*o;yJ.jB((){h.empty=true;h.sB(OL,PL,QL);uJ.pB("ChainBlast").play();var j=new xE(uJ,yJ,h.color,h.direction);j.x=v*50;j.y=GB*50;yJ.add(j);TL.q(j);qI(h);if(s.CG()==0)mL();},0.1+g*0.1);}dispatchEvent(new cB(cB.xE,{"Length":k,"Factor":i}));} jL(){NL=false;var j=new GD();for(int h=0;h<10;h++ ){for(int i=0;i<10;){var g=1;while (i+g<10&&JL[i+g-1+h*10].hC(JL[i+g+h*10]))g++ ;if(g>=3)kL(j,i,h,g,1,0);i=i+g;}}for(int i=0;i<10;i++ ){for(int h=0;h<10;){var g=1;while (h+g<10&&JL[i+(h+g-1)*10].tC(JL[i+(h+g)*10]))g++ ;if(g>=3)kL(j,i,h,g,0,1);h=h+g;}}if(j.value==0){if(GL==IC.FE)dispatchEvent(new cB(cB.yE,null));if(GL==IC.GE)dispatchEvent(new cB(cB.HE,null));if(GL==IC.HD&&PG()==false)UG();}} qI( h){if(h.KB.indexOf("Lock")==0){var k=int.parse(h.KB.substring(4,5))-1;var j=KL[k];var g=tB.IE(uJ,h.KB);g.x=h.x;g.y=h.y;q(g);var i=new eB(g,0.5,QB.FC);i.fB.x.bB(j.x);i.fB.y.bB(j.y-10);i.onComplete=()=>HC(g);yJ.add(i);yJ.jB(()=>lI(k),0.5);}} lI( k){var h=KL[k];var i;if(h.UD){i=new cB(cB.XD,{"Type":"SingleLocked","Position":new LB(h.x+20,h.y)});uJ.pB("Unlock").play();}else{i=new cB(cB.XD,{"Type":"SingleUnlocked","Position":new LB(h.x+20,h.y)});}dispatchEvent(i);h.UD=false;h.TG(false);var j=true;for(int g=0;g<KL.length;g++ ){j=j&&(KL[g].UD==false);}if(j){uJ.pB("BonusAllUnlock").play();for(int g=0;g<KL.length;g++ ){KL[g].UD=true;yJ.jB(()=>KL[(g+k)%KL.length].vI(),g*0.2);}yJ.jB(()=>dispatchEvent(new cB(cB.XD,{"Type":"All","Position":new LB(280,550)})),0.75);}} mL(){var n=new GD();for(int i=0;i<10;i++ ){var k=9;var j=8;while (k>=0){while (k>=0&&JL[i+k*10].empty==false){k-- ;j-- ;}while (j>=0&&JL[i+j*10].empty==true){j-- ;}if(k>=0){var g,h,l;if(j>=0){h=JL[i+j*10];if(i>0){l=JL[i-1+j*10];if(h.hC(l)){l.gB=false;l.sB(OL,PL,QL);}}h.gB=false;h.empty=true;h.sB(OL,PL,QL);}else{if(IL.length>0){h=IL.removeAt(0);}else{var v=HL[FL.nextInt(HL.length)];var s=FL.nextInt(2);h=new NB(uJ,yJ,v,s);}}g=JL[i+k*10];g.color=h.color;g.direction=h.direction;g.KB=h.KB;g.gB=false;g.empty=false;g.x=50*i+25;g.y=50*j+25;g.sB(OL,PL,QL);n.uD();var m=new WC(g.y,50*k+25,0.1,QB.XC);m.QC=(o){g.y=o;};m.onComplete=(){if(n.CG()==0){bL();jL();pL();}};yJ.add(m);}}}} cL( g){if(g.target==OL&&this.UB){var j=WB.min(g.lE/50,9).toInt();var h=WB.min(g.mE/50,9).toInt();var i=new LB(j,h);LL.add(i);pL();}} pL(){while (GL==IC.HD&&NL==false&&LL.length>0){var m=LL.removeAt(0);var j=m.x.toInt();var k=m.y.toInt();var g=JL[j+k*10];var i=(j>0)?JL[j-1+k*10]:null;var n=(j<9)?JL[j+1+k*10]:null;var h=(k>0)?JL[j+(k-1)*10]:null;var o=(k<9)?JL[j+(k+1)*10]:null;var l=false;if(g.KB==CB.JC){uJ.pB("ChainError").play();continue;}if(g.tC(h)){h.gB=false;h.sB(OL,PL,QL);}if(g.hC(i)){i.gB=false;i.sB(OL,PL,QL);}g.direction=1-g.direction;g.gB=false;g.PC=false;uJ.pB("ChainRotate").play();if(g.hC(n)){g.gB=true;g.PC=(g.KB==CB.SB||n.KB==CB.SB);}if(g.tC(o)){g.gB=true;g.PC=(g.KB==CB.SB||o.KB==CB.SB);}g.sB(OL,PL,QL);l=l||g.gB;if(g.tC(h)){h.gB=true;h.PC=(g.KB==CB.SB||h.KB==CB.SB);h.sB(OL,PL,QL);l=true;}if(g.hC(i)){i.gB=true;i.PC=(g.KB==CB.SB||i.KB==CB.SB);i.sB(OL,PL,QL);l=true;}if(l){uJ.pB("ChainLink").play();}jL();}}}class wE{var wF;var WG;var XG;var angle;var ZG;var TB;}class IC{static const  HD=1;static const  FE=2;static const  GE=3;}class DE extends EB{var uJ;var yJ;var KK;var PK;DE( i, j, h){uJ=i;yJ=j;var k=new JB(uJ.AB("MessageBox"));q(k);var g=new LC();g.OC=new bD("Arial",24,0xFFFFFF,bold:true,align:DC.VC);g.width=240;g.height=200;g.wordWrap=true;g.text=h;g.x=47;g.y=130-g.qE/2;g.UB=false;q(g);KK=null;OB(t.fC,ML);}void show( h){this.parent.q(this);this.x=-this.width;this.y=150;PK=h;var g=new eB(this,0.3,QB.FC);g.fB.x.bB(110);g.onComplete=()=>KK=yJ.jB(VL,10);yJ.add(g);} VL(){if(KK!=null){yJ.remove(KK);KK=null;PK();var g=new eB(this,0.4,QB.tF);g.fB.x.bB(800);g.onComplete=()=>this.parent.HC(this);yJ.add(g);}} ML( g){VL();}}class tB{static  EE( j, i, h){var g=new JB(j.bC("Elements").AB("Chain${i}${h}"));g.RC=25;g.SC=25;return g;}static  fG( j, i, h){var g=new JB(j.bC("Elements").AB("Link${i}${h}"));g.RC=25;g.SC=25;return g;}static  IE( i, h){var g=new JB(i.bC("Elements").AB(h));g.RC=25;g.SC=25;return g;}static  gG( o, n){var m=new EB();var l=0;var s=o.bC("Levelup");for(int k=0;k<7;k++ ){var g=new JB(s.AB("LevelUp${k}"));g.x=-g.width/2;g.y=-g.height/2;var h=new EB();h.q(g);h.x=l+g.width/2;h.kB=0;h.rB=0;m.q(h);var i=new eB(h,2.0,QB.JI);i.fB.kB.bB(1.0);i.fB.rB.bB(1.0);i.aC=k*0.05;var j=new eB(h,0.4,QB.XC);j.fB.kB.bB(0.0);j.fB.rB.bB(0.0);j.aC=3.0;n.add(i);n.add(j);l=l+5+g.width;}return m;}static  hG( j, h){var i=j.bC("Elements");var g=new List<DB>();g.add(i.AB("JokerChain${h}0"));g.add(i.AB("JokerChain${h}1"));g.add(i.AB("JokerChain${h}2"));g.add(i.AB("JokerChain${h}3"));g.add(i.AB("JokerChain${h}4"));return g;}static  iG( j, h){var i=j.bC("Elements");var g=new List<DB>();g.add(i.AB("JokerLink${h}0"));g.add(i.AB("JokerLink${h}1"));g.add(i.AB("JokerLink${h}2"));g.add(i.AB("JokerLink${h}3"));g.add(i.AB("JokerLink${h}4"));return g;}static  jG( j, h){var i=j.bC("Locks");var g=new List<DB>();g.add(i.AB("Lock${h}0"));g.add(i.AB("Lock${h}1"));g.add(i.AB("Lock${h}2"));g.add(i.AB("Lock${h}3"));g.add(i.AB("Lock${h}4"));return g;}static  kG( i){var h=i.bC("Head");var g=new List<DB>();g.add(h.AB("Head1"));g.add(h.AB("Head2"));g.add(h.AB("Head3"));g.add(h.AB("Head2"));g.add(h.AB("Head1"));return g;}static  lG( i){var h=i.bC("Alarm");var g=new List<DB>();g.add(h.AB("Alarm0"));g.add(h.AB("Alarm1"));g.add(h.AB("Alarm2"));g.add(h.AB("Alarm3"));g.add(h.AB("Alarm4"));g.add(h.AB("Alarm5"));return g;}}class aG extends EB{var wJ;var AK;var GK;var PK;aG( h, i){var o=new JB(h.AB("ExitBox"));q(o);var g=new LC();g.OC=new bD("Arial",24,0xFFFFFF,bold:true,align:DC.VC);g.width=240;g.height=100;g.wordWrap=true;g.text=h.ED("GENexitquery");g.x=47;g.y=150-g.qE/2;g.UB=false;q(g);wJ=new SE(7,h.AB("ExitGauge"),dD.YE);wJ.x=268;wJ.y=25;wJ.OB("TimeOver",RL);q(wJ);wJ.oD("TimeOver",0);wJ.start();var k=new JB(h.AB("ExitYesButtonNormal"));var l=new JB(h.AB("ExitYesButtonPressed"));AK=new vC(k,k,l,l);AK.x=68;AK.y=239;AK.OB(t.fC,XL);q(AK);var j=new JB(h.AB("ExitNoButtonNormal"));var m=new JB(h.AB("ExitNoButtonPressed"));GK=new vC(j,j,m,m);GK.x=173;GK.y=232;GK.OB(t.fC,ZL);q(GK);this.OB(BB.CD,(n)=>i.add(wJ));this.OB(BB.PD,(n)=>i.remove(wJ));} aL( g){if(PK!=null){PK(g);PK=null;}} XL( g){aL(true);} ZL( g){aL(false);} RL( g){aL(false);}show( g){PK=g;}}class vE extends EB{vE( m, k, l){var g=new LC();g.OC=new bD("Arial",30,0xFFFFFF,bold:true,align:DC.VC);g.width=110;g.height=36;g.wordWrap=false;g.x=646;g.y=130;g.UB=false;g.text=l.toString();g.x=-g.width/2;g.y=-g.height/2;var h=new EB();h.q(g);q(h);var j=new WC(0.0,1.0,1.5,QB.FC);j.QC=(i){h.alpha=1-i;h.y=-i*50;h.kB=1.0+0.1*WB.sin(i*10);h.rB=1.0+0.1*WB.cos(i*10);};j.onComplete=(){this.oE();};k.add(j);}}class GD{var value=0; uD([ g=1])=>(value+= g); CG([ g=1])=>(value-= g);}class IJ extends EB implements mB{var zJ;var HK;var DK;IJ( j, g, h){this.UB=false;DK=0.0;HK=tB.iG(j,h);zJ=new JB(HK[0]);zJ.x=-25;zJ.y=-25;q(zJ);OB(BB.CD,(i)=>g.add(this));OB(BB.PD,(i)=>g.remove(this));} AC( g){DK+= g;var h=(DK*10).toInt()%HK.length;zJ.GC=HK[h];return true;}}class GJ extends EB implements mB{var zJ;var HK;var DK;GJ( j, g, h){this.UB=false;DK=0.0;HK=tB.hG(j,h);zJ=new JB(HK[0]);zJ.x=-25;zJ.y=-25;q(zJ);OB(BB.CD,(i)=>g.add(this));OB(BB.PD,(i)=>g.remove(this));} AC( g){DK+= g;var h=(DK*10).toInt()%HK.length;zJ.GC=HK[h];return true;}}class cB extends BB{static const  xE="Explosion";static const  XD="Unlocked";static const  yE="Finalized";static const  HE="Timeouted";var kK;cB( h, g,[ i=false]):super(h,i){kK=g;} get info{return kK;}}class eG extends EB{var uJ;var yJ;var LK;var SK;var XK;var dK;var gK;eG( g, h){uJ=g;yJ=h;LK=tB.lG(uJ);SK=new JB(LK[0]);XK=uJ.pB("Warning");dK=null;q(SK);} start(){dK=XK.play();yJ.remove(gK);gK=new WC(0,80,9.0,QB.XC);gK.QC=(h){var g=h.toInt()%8;SK.GC=LK[(g<=4)?g+1:8-g];};yJ.add(gK);} stop(){if(dK!=null){dK.stop();dK=null;}yJ.remove(gK);SK.GC=LK[0];}}class VD extends EB{var uJ;var yJ;var CK;var zJ;var TK;var ZK;VD( h, i, g){uJ=h;yJ=i;CK=g;TK=tB.jG(uJ,g);ZK=true;zJ=new JB(TK[0]);zJ.x=-34;zJ.y=-50;q(zJ);} get UD=>ZK; set UD( g){ZK=g;} TG( g){zJ.GC=TK[g?0:4];} vI(){var i=new WC(0.0,1.0,2.0,QB.FC);i.QC=(j){kB=rB=1.0+0.2*WB.sin(j*4*WB.PI);};var g=new eB(this,0.2,QB.FC);g.fB.alpha.bB(0.0);g.aC=2.0;g.onComplete=()=>TG(ZK);var h=new eB(this,0.2,QB.tF);h.fB.alpha.bB(1);h.aC=2.2;yJ.add(i);yJ.add(g);yJ.add(h);}}class xE extends EB implements mB{var fK;var DK;xE( s, RB, o, n){fK=new List<wE>();DK=0.0;this.UB=false;var v=tB.EE(s,o,n);var m=new WB.Random();var j;var l;var GB;for(int h=0;h<=1;h++ ){for(int g=0;g<=1;g++ ){if(g==0&&h==0){j=WB.PI*1.15;TB=-WB.PI*2;}if(g==1&&h==0){j=WB.PI*1.85;TB=WB.PI*2;}if(g==1&&h==1){j=WB.PI*0.15;TB=WB.PI*2;}if(g==0&&h==1){j=WB.PI*0.85;TB=-WB.PI*2;}j=j+0.2*WB.PI*m.nextDouble();l=80.0+40.0*m.nextDouble();var k=new JB(v.GC);k.RI=new HB(g*25,h*25,25,25);k.RC=12.5+g*25;k.SC=12.5+h*25;k.x=g*25;k.y=h*25;q(k);var i=new wE();i.wF=k;i.WG=g*25+12.5;i.XG=h*25+12.5;i.angle=j;i.ZG=l;i.TB=TB;fK.add(i);}}} AC( l){DK=WB.min(0.8,DK+l);var o=981.0;for(var g in fK){var h=g.wF;var i=g.angle;var j=g.ZG;var k=g.TB;var m=g.WG+DK*(WB.cos(i)*j);var n=g.XG+DK*(WB.sin(i)*j+DK*o*0.5);h.x=m;h.y=n;h.TB=DK*k;}if(DK>=0.6){this.alpha=(0.8-DK)/0.2;}if(DK>=0.8){this.oE();}return (DK<0.8);}}class JJ extends EB{var uJ;var yJ;JJ( g){uJ=g;this.jI.listen(EL);}EL( h){yJ=cC.TD;var g=new FJ(uJ,yJ);q(new JB(uJ.AB("Background")));q(g);g.start();}}var mC;var YD;var eC;var ZD;var KC; main(){mC=new YC("Stage",lC.query('#stage'));YD=new PE();YD.LI(mC);DB.hF.webp=true;DB.DD("images/Loading.png").then((g){eC=new JB(g);eC.RC=20;eC.SC=20;eC.x=400;eC.y=270;mC.q(eC);KC=new LC();KC.OC=new bD("Arial",20,0xA0A0A0,bold:true);KC.width=240;KC.height=40;KC.text="... loading ...";KC.x=400-KC.wI/2;KC.y=320;KC.UB=false;mC.q(KC);ZD=new eB(eC,100,QB.XC);ZD.fB.TB.bB(100.0*2.0*WB.PI);YD.TD.add(ZD);mG();});} mG(){var g=new FB();g.nB("Background","images/Background.jpg");g.nB("ExitBox","images/ExitBox.png");g.nB("ExitButtonNormal","images/ExitButtonNormal.png");g.nB("ExitButtonPressed","images/ExitButtonPressed.png");g.nB("ExitGauge","images/ExitGauge.png");g.nB("ExitNoButtonNormal","images/ExitNoButtonNormal.png");g.nB("ExitNoButtonPressed","images/ExitNoButtonPressed.png");g.nB("ExitYesButtonNormal","images/ExitYesButtonNormal.png");g.nB("ExitYesButtonPressed","images/ExitYesButtonPressed.png");g.nB("InfoBox","images/InfoBox.png");g.nB("MessageBox","images/MessageBox.png");g.nB("ShuffleButtonNormal","images/ShuffleButtonNormal.png");g.nB("ShuffleButtonPressed","images/ShuffleButtonPressed.png");g.nB("TimeGauge","images/TimeGauge.png");g.RD("Alarm","images/AlarmTextureAtlas.json",rC.BD);g.RD("Head","images/HeadTextureAtlas.json",rC.BD);g.RD("Elements","images/ElementsTextureAtlas.json",rC.BD);g.RD("Levelup","images/LevelupTextureAtlas.json",rC.BD);g.RD("Locks","images/LocksTextureAtlas.json",rC.BD);g.aB("BonusAllUnlock","sounds/BonusAllUnlock.mp3");g.aB("BonusUniversal","sounds/BonusUniversal.mp3");g.aB("ChainBlast","sounds/ChainBlast.mp3");g.aB("ChainBlastSpecial","sounds/ChainBlastSpecial.mp3");g.aB("ChainError","sounds/ChainError.mp3");g.aB("ChainFall","sounds/ChainFall.mp3");g.aB("ChainHelp","sounds/ChainHelp.mp3");g.aB("ChainLink","sounds/ChainLink.mp3");g.aB("ChainRotate","sounds/ChainRotate.mp3");g.aB("Click","sounds/Click.mp3");g.aB("GameOver","sounds/GameOver.mp3");g.aB("Laugh","sounds/Laugh.mp3");g.aB("LevelUp","sounds/LevelUp.mp3");g.aB("PointsCounter","sounds/PointsCounter.mp3");g.aB("Unlock","sounds/Unlock.mp3");g.aB("Warning","sounds/Warning.mp3");g.aB("Intro","sounds/Intro.mp3");g.zB("ESCAPE_INS_AIM_0","Connect at least 3 chain links of the same colour to a horizontal or vertical chain.");g.zB("ESCAPE_INS_DES_0","You can change the direction of a chain link by touching it.");g.zB("ESCAPE_INS_TIP_0","Earn extra points for connecting chain links displaying a key symbol.");g.zB("ESCBlockErrorHint","Sorry but block chains can´t be twisted!");g.zB("ESCLevelBoxText","Connect {0} chain links and help the crook to escape!");g.zB("ESCNoActionHint","Press on the chain links to twist them.");g.zB("ESCNoComboHint","You have to connect at least 3 chain links of the same colour.");g.zB("ESCStartText","Form horizontal or vertical same-colour chains and become an escape agent!");g.zB("ESCtogo","Chain links:");g.zB("GENexitquery","Do you really want to quit the game?");g.zB("GEN2ndchancetime","Time is up. Second chance!");g.zB("GENtimeup","Sorry! Your time is up.");g.zB("GENgameover","Game Over");g.load().then((j){mC.HC(eC);mC.HC(KC);YD.TD.remove(ZD);mC.q(new JJ(g));}).catchError((i){for(var h in g.FG){print("Loading resouce failed: ${h.kind}.${h.name} - ${h.error}");}});}class KJ{static const  LJ="Chrome";static const  MJ="Firefox";static const  NJ="Internet Explorer";static const  OJ="Safari";final  NI;final  minimumVersion;const KJ(this.NI,[this.minimumVersion]);}class PJ{const PJ();}class QJ{final  name;const QJ(this.name);}class RJ{const RJ();}class SJ{const SJ();}const TJ=const UJ();class UJ{const UJ();}class KE{var png;var jpg;var webp;var autoHiDpi;KE({this.png: true,this.jpg: true,this.webp: false,this.autoHiDpi: true});}class cD extends BB{cD( g):super(g,false); get qD=>false;}abstract class PB extends u{var TI=false;var UB=true;var lJ=true;var tabIndex=0;static const  QH=const uB<t>(t.jD);static const  cH=const uB<t>(t.XF);static const  hH=const uB<t>(t.hD);static const  nH=const uB<t>(t.ZE);static const  wH=const uB<t>(t.dF); get onMouseOut=>PB.QH.forTarget(this); get onMouseMove=>PB.cH.forTarget(this); get onMouseDown=>PB.hH.forTarget(this); get onMouseUp=>PB.nH.forTarget(this); get onMouseWheel=>PB.wH.forTarget(this);static const  yH=const uB<YB>(YB.VF);static const  zH=const uB<YB>(YB.LF);static const  AI=const uB<YB>(YB.PF); get onTouchMove=>PB.yH.forTarget(this); get onTouchEnd=>PB.zH.forTarget(this); get onTouchCancel=>PB.AI.forTarget(this);static const  DI=const uB<UC>(UC.KF);static const  FI=const uB<UC>(UC.IF); get onKeyUp=>PB.DI.forTarget(this); get onKeyDown=>PB.FI.forTarget(this);static const  HI=const uB<JD>(JD.JF); get kI=>PB.HI.forTarget(this);}abstract class pC extends PB{final  gM=new List<u>();var vM=true;var LN=true; q( g){if(g.parent==this){var h=gM.indexOf(g);gM.removeAt(h);gM.add(g);}else{KI(g,gM.length);}} KI( g, h){if(h<0||h>gM.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");if(g==this)throw new ArgumentError("Error #2024: An object cannot be added as a child of itself.");if(g.parent==this){gM.removeAt(gM.indexOf(g));if(h>gM.length)h-- ;gM.insert(h,g);}else{g.oE();g.xP(this);gM.insert(h,g);g.dispatchEvent(new BB(BB.xG,true));if(this.cC!=null)EQ(g,new BB(BB.CD));}} HC( h){var g=gM.indexOf(h);if(g==-1)throw new ArgumentError("Error #2025: The supplied DisplayObject must be a child of the caller.");rI(g);} rI( g){if(g<0||g>=gM.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");var h=gM[g];h.dispatchEvent(new BB(BB.SH,true));if(this.cC!=null)EQ(h,new BB(BB.PD));h.xP(null);gM.removeAt(g);} contains( g){for(;g!=null;g=g.FP)if(g==this)return true;return false;} oB( o,[ g]){if(g==null)g=new HB.mJ();if(gM.length==0)return super.oB(o,g);var i=double.INFINITY;var j=double.INFINITY;var l=double.NEGATIVE_INFINITY;var k=double.NEGATIVE_INFINITY;var s=gM.length;for(int m=0;m<gM.length;m++ ){var n=gM[m];IP.iE(n.bP,o);var h=n.oB(IP,g);if(h.left<i)i=h.left;if(h.top<j)j=h.top;if(h.right>l)l=h.right;if(h.bottom>k)k=h.bottom;}g.x=i;g.y=j;g.width=l-i;g.height=k-j;return g;} qB( i, k){i=i.toDouble();k=k.toDouble();var n=null;for(int l=gM.length-1;l>=0;l-- ){var j=gM[l];if(j.kQ){var g=j.bP;var o=i-g.BC;var m=k-g.CC;var v=(g.d*o-g.c*m)/g.iC;var s=(g.a*m-g.b*o)/g.iC;var h=j.qB(v,s);if(h!=null){if(h is PB)if(h.UB)return vM?h:this;n=this;}}}return n;} hB( i){for(int g=0;g<gM.length;g++ ){var h=gM[g];if(h.kQ)i.SG(h);}}lQ( g, i){i.add(g);if(g is pC){var k=g as pC;var j=k.gM;for(int h=0;h<j.length;h++ ){lQ(j[h],i);}}}EQ( i, j){var g=lD.OG() as List<u>;lQ(i,g);for(int h=0;h<g.length;h++ ){g[h].dispatchEvent(j);}g.clear();lD.QG(g);}}class ID{static const  uG="exactFit";static const  CH="noBorder";static const  KH="noScale";static const  TF="showAll";}abstract class qG{}class LB{var qL;var uL;LB( h, g):qL=h,uL=g;LB.mJ():this(0,0); clone()=>new LB(qL,uL); toString()=>"Point [x=${qL}, y=${uL}]"; get x=>qL; get y=>uL; get length=>WB.sqrt(qL*qL+uL*uL);set x( g){qL=g;}set y( g){uL=g;} add( g){return new LB(qL+g.x,uL+g.y);} subtract( g){return new LB(qL-g.x,uL-g.y);}sD( g){qL=g.x;uL=g.y;} EG( g){return qL==g.x&&uL==g.y;}}class HB{var qL;var uL;var CM;var OM;HB( i, g, h, j):qL=i,uL=g,CM=h,OM=j;HB.mJ():this(0,0,0,0); clone()=>new HB(qL,uL,CM,OM); toString()=>"Rectangle [x=${qL}, y=${uL}, width=${CM}, height=${OM}]"; get x=>qL; get y=>uL; get width=>CM; get height=>OM; get left=>qL; get top=>uL; get right=>qL+CM; get bottom=>uL+OM; get size=>new LB(CM,OM);set x( g){qL=g;}set y( g){uL=g;}set width( g){CM=g;}set height( g){OM=g;}set bottom( g){this.height=g-uL;}set left( g){qL=g;}set right( g){CM=g-qL;}set top( g){uL=g;} contains( g, h){return qL<=g&&uL<=h&&qL+CM>=g&&uL+OM>=h;} EG( g){return qL==g.x&&uL==g.y&&CM==g.width&&OM==g.height;} get isEmpty{return CM==0&&OM==0;}sD( g){qL=g.x;uL=g.y;CM=g.width;OM=g.height;} union( g){var i=WB.min(this.left,g.left);var h=WB.min(this.top,g.top);var j=WB.max(this.right,g.right);var k=WB.max(this.bottom,g.bottom);return new HB(i,h,j-i,k-h);} align(){var h=this.left.floor();var g=this.top.floor();var i=this.right.ceil();var j=this.bottom.ceil();return new HB(h,g,i-h,j-g);}}class IB{var rL,tL,wL,xL,AM,DM;var PM;IB( h, i, g, j, k, l):rL=h.toDouble(),tL=i.toDouble(),wL=g.toDouble(),xL=j.toDouble(),AM=k.toDouble(),DM=l.toDouble(),PM=(h*j-i*g).toDouble();IB.qJ():rL=1.0,tL=0.0,wL=0.0,xL=1.0,AM=0.0,DM=0.0,PM=1.0; clone(){return new IB(rL,tL,wL,xL,AM,DM);} AG(){var h=(xL/PM);var i=-(tL/PM);var g=-(wL/PM);var j=(rL/PM);var k=-(h*AM+g*DM);var l=-(i*AM+j*DM);return new IB(h,i,g,j,k,l);} get a=>rL; get b=>tL; get c=>wL; get d=>xL; get BC=>AM; get CC=>DM; get iC=>PM; CE( h){var i=h.x.toDouble();var g=h.y.toDouble();return new LB(i*rL+g*wL+AM,i*tL+g*xL+DM);} zP( h){var i=h.x.toDouble();var g=h.y.toDouble();return new LB(i*rL+g*wL+AM,i*tL+g*xL+DM);} concat( g){var m=rL;var s=tL;var v=wL;var o=xL;var l=AM;var n=DM;var RB=PM;var j=g.a;var k=g.b;var i=g.c;var h=g.d;var VB=g.BC;var GB=g.CC;var lB=g.iC;rL=(m*j+s*i).toDouble();tL=(m*k+s*h).toDouble();wL=(v*j+o*i).toDouble();xL=(v*k+o*h).toDouble();AM=(l*j+n*i+VB).toDouble();DM=(l*k+n*h+GB).toDouble();PM=(RB*lB).toDouble();} YI(){rL=1.0;tL=0.0;wL=0.0;xL=1.0;AM=0.0;DM=0.0;PM=1.0;} IG(){var j=rL;var m=tL;var l=wL;var k=xL;var h=AM;var i=DM;var g=PM;rL=(k/g).toDouble();tL=-(m/g).toDouble();wL=-(l/g).toDouble();xL=(j/g).toDouble();AM=-(rL*h+wL*i).toDouble();DM=-(tL*h+xL*i).toDouble();PM=(1.0/g).toDouble();} scale( h, g){rL=(rL*h).toDouble();tL=(tL*g).toDouble();wL=(wL*h).toDouble();xL=(xL*g).toDouble();AM=(AM*h).toDouble();DM=(DM*g).toDouble();PM=(PM*h*g).toDouble();} translate( g, h){AM=(AM+g).toDouble();DM=(DM+h).toDouble();} xD( h, i, g, k, j, l){rL=h.toDouble();tL=i.toDouble();wL=g.toDouble();xL=k.toDouble();AM=j.toDouble();DM=l.toDouble();PM=(rL*xL-tL*wL).toDouble();} sD( g){rL=g.a.toDouble();tL=g.b.toDouble();wL=g.c.toDouble();xL=g.d.toDouble();AM=g.BC.toDouble();DM=g.CC.toDouble();PM=g.iC.toDouble();} iE( h, g){var n=h.a;var v=h.b;var GB=h.c;var s=h.d;var m=h.BC;var o=h.CC;var VB=h.iC;var k=g.a;var l=g.b;var j=g.c;var i=g.d;var lB=g.BC;var RB=g.CC;var dC=g.iC;rL=(n*k+v*j).toDouble();tL=(n*l+v*i).toDouble();wL=(GB*k+s*j).toDouble();xL=(GB*l+s*i).toDouble();AM=(m*k+o*j+lB).toDouble();DM=(m*l+o*i+RB).toDouble();PM=(VB*dC).toDouble();}}abstract class mB{ AC( g);}class EB extends pC{var ZJ=false;var tE=false;var kE=null;var yM=null;var QN=null;gP(){var i=this.vD;var j=this.cC;var m=this.visible;if(i!=null&&this.cC!=null){var h=oC.OH;if(h!=null){var g=bP.CE(i);if(g.x<h.left)g.x=h.left;if(g.x>h.right)g.x=h.right;if(g.y<h.top)g.y=h.top;if(g.y>h.bottom)g.y=h.bottom;i=bP.AG().CE(g);}var l=new LB(KN,WN).add(i).subtract(oC.LH);var k=bP.CE(l);this.visible=false;QN=j.qB(j.fI,j.gI);this.x=k.x;this.y=k.y;this.visible=m;}} oB( h,[ g]){if(g==null)g=new HB.mJ();super.oB(h,g);if(yM!=null){g=yM.WQ(h).union(g);}return g;} qB( i, j){var h=null;if(this.kE!=null){var g=this.rE(this.kE);if(g!=null){var k=i*g.a+j*g.c+g.BC;var l=i*g.b+j*g.d+g.CC;if(this.kE.qB(k,l)!=null){h=this;}}}else{h=super.qB(i,j);if(h==null&&yM!=null){if(yM.aQ(i,j)){h=this;}}}return h;}hB( g){if(yM!=null)yM.hB(g);super.hB(g);}}class JB extends u{var FM;var TM;var lM;JB([ h=null, g="auto"]){this.GC=h;this.pI=g;lM=null;} get GC=>FM;set GC( g){if(g==null)FM=null;if(g is DB)FM=g;}set pI( g){if(g is String)TM=g;}set RI( g){if(g==null)lM=null;if(g is HB)lM=g;} oB( k,[ j]){var g=FM;var h=0,i=0;if(g!=null){h=g.width;i=g.height;}return fE(k,h,i,j);} qB( h, i){var g=FM;if(g==null)return null;if(h<0.0||i<0)return null;if(h>=g.width||i>=g.height)return null;return this;} hB( h){var g=FM;if(g==null)return;if(lM==null){g.hB(h);}else{g.RG(h,lM);}}}class RE implements mB{final  NM;var VM=0.0;var jM=0.0;var qM=1;RE( g, h):NM=g{jM=WB.max(h,0.0001);} AC( h){var g=VM+h;while (g>=jM&&qM>0){VM=jM;qM-- ;NM();g-= jM;}VM=g;return (qM>0);} get FD=>jM; get currentTime=>VM;}abstract class NE{ hB( g);}class vC extends PB{var upState;var overState;var downState;var hitTestState;var tE=true;var enabled=true;var hN;vC([this.upState,this.overState,this.downState,this.hitTestState]){OB(t.cF,UO);OB(t.jD,UO);OB(t.hD,UO);OB(t.ZE,UO);hN=this.upState;} oB( h,[ g]){if(hN!=null){IP.iE(hN.bP,h);return hN.oB(IP,g);}return super.oB(h,g);} qB( k, l){if(this.hitTestState!=null){var g=this.hitTestState.bP;var h=k-g.BC;var i=l-g.CC;var m=(g.d*h-g.c*i)/g.iC;var j=(g.a*i-g.b*h)/g.iC;if(this.hitTestState.qB(m,j)!=null)return this;}return null;} hB( g){if(hN!=null)g.SG(hN);} UO( g){if(g.type==t.jD){hN=upState;}else{hN=g.ZC?downState:overState;}}}class nG{}final  TE=new Map<String,aE>();class qC{static const  FF=1;static const  eD=2;static const  GH=3;}abstract class JE{var kC=null;var border=false;var borderColor=0xFF000000;var borderWidth=1;var HN;JE();factory JE.oJ( i, g, h, j){return new XJ(i,g,h,j);}MI( h, g){HN=h.context;HN.setTransform(g.a,g.b,g.c,g.d,g.BC,g.CC);HN.beginPath();cP();HN.save();HN.clip();}VI(){HN.restore();if(border){HN.strokeStyle=ZF(borderColor);HN.lineWidth=borderWidth;HN.lineCap="round";HN.lineJoin="round";HN.stroke();}}cP();}class OE{var gC;var uC;}class pG{}class YB extends BB{static const  HF="touchBegin";static const  LF="touchEnd";static const  PF="touchCancel";static const  VF="touchMove";static const  RH="touchOver";static const  VH="touchOut";var KP;var NP;var PP,QP;var SP,TP;var kN;var PO;var sN;var AO;var YP;var ZP;var aP;YB( g,[ h=false]):super(g,h){dP(g,h);} dP( g,[ h=false]){super.dP(g,h);KP=0;NP=false;PP=QP=0;SP=TP=0;kN=false;PO=false;sN=false;AO=false;YP=1.00;ZP=0;aP=0;}set vP( g){PP=g.x;QP=g.y;}set wP( g){SP=g.x;TP=g.y;} get BE=>KP; get lE=>PP; get mE=>QP; get altKey=>kN; get ctrlKey=>sN; get shiftKey=>AO;}class dD extends u{static const  VE='DIRECTION_UP';static const  MF='DIRECTION_RIGHT';static const  YE='DIRECTION_DOWN';static const  iD='DIRECTION_LEFT';var yN;var EO;var FM;var lM;dD( h,[ g=iD]){if(g!=VE&&g!=YE&&g!=iD&&g!=MF){throw new ArgumentError('Invalid Gauge direction!');}yN=g;EO=1.0;FM=h;lM=new HB.mJ();MP();} get ratio=>EO;set ratio( g){if(g<0.0)g=0.0;if(g>1.0)g=1.0;EO=g;MP();} get GC=>FM;set GC( g){FM=g;MP();}MP(){if(FM==null){lM.left=0;lM.top=0;lM.right=0;lM.bottom=0;}else{var h=FM.width;var g=FM.height;switch (yN){case iD:lM.left=((1.0-EO)*h).toInt();lM.top=0;lM.right=h;lM.bottom=g;break;case VE:lM.left=0;lM.top=((1.0-EO)*g).toInt();lM.right=h;lM.bottom=g;break;case MF:lM.left=0;lM.top=0;lM.right=(EO*h).toInt();lM.bottom=g;break;case YE:lM.left=0;lM.top=0;lM.right=h;lM.bottom=(EO*g).toInt();break;}}} oB( i,[ g]){var h=(FM!=null)?FM.width:0;var j=(FM!=null)?FM.height:0;return fE(i,h,j,g);} qB( g, h){if(FM!=null&&g>=0.0&&h>=0.0&&g<FM.width&&h<FM.height)return this;return null;} hB( g){if(FM!=null)FM.RG(g,lM);}}abstract class u extends NC implements NE{static var DH=0;var oM=DH++ ;var qL=0.0;var uL=0.0;var KN=0.0;var WN=0.0;var cN=1.0;var lN=1.0;var rN=0.0;var wN=0.0;var FO=0.0;var LO=1.0;var OO=true;var SO=false;var YO=null;var dO=null;var jO=null;var nO=false;var tO=null;var vO=null;var yO=null;var MM="";var FP=null;final  IP=new IB.qJ();final  LP=new IB.qJ();var RP=true;static const  sH=const uB<BB>(BB.CD); get jI=>u.sH.forTarget(this); get x=>qL; get y=>uL; get RC=>KN; get SC=>WN; get kB=>cN; get rB=>lN; get skewX=>rN; get skewY=>wN; get TB=>FO; get visible=>OO; get alpha=>LO; get OI=>dO!=null; get rD=>yO; get name=>MM; get parent=>FP; get vD{var g=this.cC;return (g!=null)?this.jC(g.QQ):null;} get fI{var g=this.vD;return (g!=null)?g.x:0.0;} get gI{var g=this.vD;return (g!=null)?g.y:0.0;} get root{var g=this;while (g.FP!=null)g=g.FP;return g;} get cC{var g=this.root;return (g is YC)?g:null;}set x( g){if(g is num)qL=g;RP=true;}set y( g){if(g is num)uL=g;RP=true;}set RC( g){if(g is num)KN=g;RP=true;}set SC( g){if(g is num)WN=g;RP=true;}set kB( g){if(g is num)cN=g;RP=true;}set rB( g){if(g is num)lN=g;RP=true;}set skewX( g){if(g is num)rN=g;RP=true;}set skewY( g){if(g is num)wN=g;RP=true;}set TB( g){if(g is num)FO=g;RP=true;}set visible( g){if(g is bool)OO=g;}set alpha( g){if(g is num)LO=g;}set mask( g){YO=g;}set rD( g){yO=g;} setTransform( k, l,[ n, g, h, o, j, i, m]){if(k is num)qL=k;if(l is num)uL=l;if(n is num)cN=n;if(g is num)lN=g;if(h is num)FO=h;if(o is num)rN=o;if(j is num)wN=j;if(i is num)KN=i;if(m is num)WN=m;RP=true;} get width=>oB(bP).width; get height=>oB(bP).height; set width( h){this.kB=1;var g=this.width;this.kB=(g!=0.0)?h/g:1.0;} set height( h){this.rB=1;var g=this.height;this.rB=(g!=0.0)?h/g:1.0;} oE(){if(FP!=null)FP.HC(this);} get kQ=>OO&&!SO; get bP{if(RP){RP=false;var j=rN+FO;var i=wN+FO;if(j==0.0&&i==0.0){LP.xD(cN,0.0,0.0,lN,qL-KN*cN,uL-WN*lN);}else{var g,l,k,h;var m=WB.cos(j);var n=WB.sin(j);if(j==i){g=cN*m;l=cN*n;k=-lN*n;h=lN*m;}else{g=cN*WB.cos(i);l=cN*WB.sin(i);k=-lN*n;h=lN*m;}var s=qL-(KN*g+WN*k);var o=uL-(KN*l+WN*h);LP.xD(g,l,k,h,s,o);}}return LP;} rE( h){if(h==FP)return bP.clone();if(h.FP==this)return h.bP.AG();var j=new IB.qJ();var g=this;while (g!=h&&g.FP!=null){j.concat(g.bP);g=g.FP;}if(h==null&&g!=null){j.concat(g.bP);g=null;}if(g==h)return j;var k=new IB.qJ();var i=h;while (i!=this&&i.FP!=null){k.concat(i.bP);i=i.FP;}k.IG();if(i==this)return k;if(i!=g)return null;j.concat(k);return j;} oB( h,[ g]){if(g==null)g=new HB.mJ();g.x=h.BC;g.y=h.CC;g.width=0;g.height=0;return g;} qB( g, h){if(oB(eE).contains(g,h))return this;return null;} jC( h){IP.YI();for(u g=this;g!=null;g=g.FP)IP.concat(g.bP);IP.IG();return IP.CE(h);} dQ( g){g.context.translate(jO.x,jO.y);dO.hB(g);} dispatchEvent( h){var g=null;if(h.qD||h.bubbles){for(u j=FP;j!=null;j=j.FP){if(j.kP(h.type,h.qD,h.bubbles)){if(g==null)g=lD.OG() as List<u>;g.add(j);}}}if(h.qD&&g!=null){for(int i=g.length-1;i>=0&&h.zD==false;i-- ){g[i].HP(h,this,g[i],qC.FF);}}if(h.zD==false){HP(h,this,this,qC.eD);}if(h.bubbles&&g!=null){for(int i=0;i<g.length&&h.zD==false;i++ ){g[i].HP(h,this,g[i],qC.GH);}}if(g!=null){g.clear();lD.QG(g);}} xP( h){for(var g=h;g!=null;g=g.FP)if(g==this)throw new ArgumentError("Error #2150: An object cannot be added as a child to one of it's children (or children's children, etc.).");FP=h;} hB( g);}abstract class dB{static  DD( g,[ h=null]){switch (zC.WH){case "WebAudioApi":return QE.DD(g,h);case "AudioElement":return LE.DD(g,h);default:return nC.DD(g,h);}}static var hF=new sC(mp3:true,mp4:true,ogg:true,wav:true); get length; play([ h=false, g]);}abstract class TC extends NC{ get MC; set MC( g); stop();}class sC{var mp3;var mp4;var ogg;var wav;var ignoreErrors;sC({this.mp3: false,this.mp4: false,this.ogg: false,this.wav: false,this.ignoreErrors: true});}class XB{var volume;var pan;var gJ=1;var hJ=0;var kJ=1;var jJ=0;XB([this.volume=1,this.pan=0]);}class zC{static var WH=lH();static var kD=tH();static var iF=vH();static  lH(){var h=(kD!=null)?"WebAudioApi":"AudioElement";var g=lC.window.navigator.userAgent;if(g.contains("IEMobile"))if(g.contains("9.0")||g.contains("10.0"))h="Mock";if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod"))if(g.contains("OS 3")||g.contains("OS 4")||g.contains("OS 5"))h="Mock";if(iF.length==0)h="Mock";print("StageXL: supported audio engine is: ${h}");return h;}static  tH(){if(uE.AudioContext.supported)return new uE.AudioContext();return null;}static  vH(){var g=new List<String>();var h=new lC.AudioElement();var i=["maybe","probably"];if(i.indexOf(h.canPlayType("audio/mpeg",""))!=-1)g.add("mp3");if(i.indexOf(h.canPlayType("audio/mp4",""))!=-1)g.add("mp4");if(i.indexOf(h.canPlayType("audio/ogg",""))!=-1)g.add("ogg");if(i.indexOf(h.canPlayType("audio/wav",""))!=-1)g.add("wav");print("StageXL: supported audio types are: ${g}");return g;}static  uF( i, h){var l=new RegExp(r"(mp3|mp4|ogg|wav)$",multiLine:false,caseSensitive:true);var g=iF.toList();var k=l.firstMatch(i);var j=new List<String>();if(k==null){throw new ArgumentError("Unsupported file extension.");}if(g.length==0){throw new UnsupportedError("This browser supports no known audio codec.");}if(!h.mp3)g.remove("mp3");if(!h.mp4)g.remove("mp4");if(!h.ogg)g.remove("ogg");if(!h.wav)g.remove("wav");var m=k.group(1);if(g.contains(m)){j.add(i);g.remove(m);}for(var n in g){j.add(i.replaceAll(l,n));}return j;}}class LE extends dB{var LM;var bM;var uM;LE(){uM=new List<aD>();LM=new lC.AudioElement();LM.onEnded.listen(HO);bM=new List<lC.AudioElement>();bM.add(LM);lC.document.body.children.add(LM);}static  DD( l,[ g=null]){if(g==null)g=dB.hF;var n=new LE();var h=n.LM;var i=zC.uF(l,g);var j=new ZB.Completer<dB>();if(i.length==0){return nC.DD(l,g);}var k;var m;GB(s){k.cancel();m.cancel();j.complete(n);}o(s){if(i.length>0){h.src=i.removeAt(0);h.load();}else{k.cancel();m.cancel();if(g.ignoreErrors){nC.DD(l,g).then((v)=>j.complete(v));}else{j.completeError(new StateError("Failed to load audio."));}}}k=h.onCanPlayThrough.listen(GB);m=h.onError.listen(o);h.src=i.removeAt(0);h.load();return j.future;} get length{return LM.duration;} play([ h=false, g]){if(g==null)g=new XB();return new aD(this,h,g);} ZO( h){var g;if(bM.length==0){g=LM.clone(true);g.onEnded.listen(HO);}else{g=bM.removeAt(0);}uM.add(h);return g;} nP( g){var h=g.LM;var i=uM.indexOf(g);uM.removeAt(i);bM.add(h);if(LM.currentTime>0&&LM.ended==false)LM.currentTime=0;} HO( j){var i=j.target;var g=null;for(int h=0;h<uM.length&&g==null;h++ )if(uM[h].LM==i)g=uM[h];if(g!=null)g.stop();}}class aD extends TC{var WM;var LM;var KM;var ZM;aD( g, i, h){WM=g;KM=i;ZM=h;LM=g.ZO(this);LM.loop=KM;this.MC=h;LM.play();} get MC=>ZM; set MC( g){ZM=g;if(LM!=null)LM.volume=(ZM!=null)?ZM.volume:1;} stop(){if(LM!=null){if(LM.ended==false)LM.pause();WM.nP(this);LM=null;}}}class QE extends dB{var IM;QE(){if(zC.kD==null)throw new UnsupportedError("This browser does not support Web Audio API.");}static  DD( i,[ g=null]){if(g==null)g=dB.hF;var m=new QE();var h=new ZB.Completer<dB>();var j=zC.uF(i,g);var v=zC.kD;if(j.length==0){return nC.DD(i,g);}GB(n){v.decodeAudioData(n.response).then(( s){m.IM=s;h.complete(m);}).catchError((o){if(g.ignoreErrors){nC.DD(i,g).then((k)=>h.complete(k));}else{h.completeError(new StateError("Failed to decode audio."));}});}l(o){if(j.length>0){lC.HttpRequest.request(j.removeAt(0),responseType:'arraybuffer').then(GB).catchError(l);}else{if(g.ignoreErrors){nC.DD(i,g).then((k)=>h.complete(k));}else{h.completeError(new StateError("Failed to load audio."));}}}l(null);return h.future;} get length{return IM.duration;} play([ h=false, g]){if(g==null)g=new XB();return new VJ(this,h,g);}}class VJ extends TC{var SM;var ZM;var KM;var BN;var UN;VJ( j, h, i){SM=j;KM=h;ZM=i;var g=zC.kD;BN=g.createGain();BN.connectNode(g.destination,0,0);BN.gain.value=(ZM!=null)?WB.pow(ZM.volume,2):1;UN=g.createBufferSource();UN.buffer=SM.IM;UN.loop=h;UN.connectNode(BN,0,0);UN.start(0);} get MC=>ZM; set MC( g){ZM=g;BN.gain.value=(ZM!=null)?WB.pow(ZM.volume,2):1;} stop(){UN.stop(0);}}class nC extends dB{nC(){}static  DD( g,[ h=null]){return new ZB.Future<dB>.value(new nC());} get length{return double.NAN;} play([ h=false, g]){if(g==null){g=new XB();}return new WJ(this,h,g);}}class WJ extends TC{var KM;var ZM;WJ( i, h, g){KM=h;ZM=g;} get MC=>ZM;set MC( g){ZM=g;} stop(){}}class AD{static const  tG=0;static const  yG=1;static const  eF=2;static const  JH=3;static const  SF=4;}class LC extends PB{var vL="";var YM=null;var pM=oG.bE;var EN=xC.vG;var XN=0;var gN=0;var nN=0.0;var uN=0.0;var CO=0.0;var KO=0.0;var NO=0.0;var RO=false;var WO=false;var aO=false;var hO=false;var mO=false;var pO="•";var sO=0xFFFFFF;var wO=0x000000;var BP=0;var CM=100;var OM=100;var EP=0.0;var GP=0.0;final  JP=new List<KD>();var OP=true;var WP=null;var HN=null;LC([ h, g]){this.text=(h!=null)?h:"";this.OC=(g!=null)?g:new bD("Arial",12,0x000000);this.onKeyDown.listen(mP);this.kI.listen(pP);this.onMouseDown.listen(sP);} get text=>vL; get type=>EN; get border=>mO; get borderColor=>wO; get width=>CM; get height=>OM; set text( g){vL=g.replaceAll('\r\n','\n').replaceAll('\r','\n');XN=vL.length;OP=true;} set OC( g){YM=g.clone();OP=true;} set wordWrap( g){RO=g;OP=true;} set width( g){CM=g.toDouble();OP=true;} set height( g){OM=g.toDouble();OP=true;} get wI{cQ();return EP;} get qE{cQ();return GP;} oB( h,[ g]){return fE(h,CM,OM,g);} qB( g, h){if(g>=0&&h>=0&&g<CM&&h<OM)return this;return null;} hB( i){cQ();nN+= i.SI;var g=i.HN;g.drawImageScaled(WP,0.0,0.0,CM,OM);if(EN==xC.ND){var h=this.cC;if(h!=null&&h.focus==this&&nN.remainder(0.8)<0.4){g.fillStyle=OD(YM.color);g.fillRect(uN,CO,KO,NO);}}}hQ( lB){JP.clear();var j=0;var h='';var n='';var dC=0;var k=YM.size.toDouble();var yI=YM.leftMargin.toDouble();var zI=YM.topMargin.toDouble();var AJ=YM.align.toString();var VB=lB.pD.toDouble();var BJ=lB.jE.toDouble();for(var RB in vL.split('\n')){if(RO==false){JP.add(new KD.nJ(RB,j));j+= RB.length+1;}else{h=null;for(var GB in RB.split(' ')){n=h;h=(n==null)?GB:"${n} ${GB}";h=jQ(h);dC=HN.measureText(h).width.toDouble();if(dC>=CM){if(n==null){JP.add(new KD.nJ(h,j));j+= h.length+1;h=null;}else{JP.add(new KD.nJ(n,j));j+= n.length+1;h=jQ(GB);}}}if(h!=null){JP.add(new KD.nJ(h,j));j+= h.length+1;}}}EP=0.0;GP=0.0;var s=0.0;var v=zI+k;for(int i=0;i<JP.length;i++ ){var g=JP[i];if(g is !KD)continue;var o=HN.measureText(g.vL).width.toDouble();switch (AJ){case DC.VC:case DC.HH:s=(CM-o)/2;break;case DC.eF:case DC.BH:s=(CM-o);break;default:s=yI;}g.qL=s;g.uL=v;g.CM=o;g.OM=k;g.GN=VB;g.TN=BJ;g.bN=0.0;v=v+k;EP=WB.max(EP,o);GP=GP+k;}if(EN==xC.ND){for(int i=JP.length-1;i>=0;i-- ){var g=JP[i];if(g is !KD)continue;if(XN>=g.BM){var CJ=XN-g.BM;var DJ=g.vL.substring(0,CJ);gN=i;uN=g.qL+HN.measureText(DJ).width.toDouble();CO=g.uL-VB*0.9;KO=1.0;NO=k;break;}}var l=0.0;var m=0.0;while (l+uN>CM)l-= CM*0.2;while (l+uN<0)l+= CM*0.2;while (m+CO+NO>OM)m-= k;while (m+CO<0)m+= k;uN+= l;CO+= m;for(int i=0;i<JP.length;i++ ){var g=JP[i];if(g is !KD)continue;g.qL+= l;g.uL+= m;}}} jQ( g){if(g is !String)return g;if(aO==false)return g;var h="";for(int i=0;i<g.length;i++ ){h="${h}${pO}";}return h;}cQ({ calculateOnly: false}){if(OP){OP=false;var h=(YC.dE?nD:1.0)/mD;var k=(CM*h).ceil();var i=(OM*h).ceil();if(WP==null){WP=new lC.CanvasElement(width:k,height:i);HN=WP.context2D;}if(WP.width!=k)WP.width=k;if(WP.height!=i)WP.height=i;var g="${YM.size}px ${YM.font},sans-serif";if(YM.bold)g="bold ${g}";if(YM.italic)g="italic ${g}";HN.font=g;HN.textAlign="start";HN.textBaseline="alphabetic";HN.setTransform(1.0,0.0,0.0,1.0,0.0,0.0);hQ(FH(g));if(calculateOnly){OP=true;return;}HN.setTransform(h,0.0,0.0,h,0.0,0.0);if(hO){HN.fillStyle=OD(sO);HN.fillRect(0,0,CM,OM);}else{HN.clearRect(0,0,CM,OM);}HN.fillStyle=OD(YM.color);for(int l=0;l<JP.length;l++ ){var j=JP[l];HN.fillText(j.vL,j.qL,j.uL);}if(mO){HN.strokeStyle=OD(wO);HN.lineWidth=1;HN.strokeRect(0,0,CM,OM);}}}mP( v){if(EN==xC.ND){cQ(calculateOnly:true);var l=vL;var n=l.length;var j=JP;var g=XN;var i=gN;var h=-1;switch (v.keyCode){case lC.KeyCode.BACKSPACE:if(g>0){vL=l.substring(0,g-1)+l.substring(g);h=g-1;}break;case lC.KeyCode.END:var m=j[i];h=m.BM+m.vL.length;break;case lC.KeyCode.HOME:var m=j[i];h=m.BM;break;case lC.KeyCode.LEFT:if(g>0){h=g-1;}break;case lC.KeyCode.UP:if(i>0&&i<j.length){var o=j[i];var k=j[i-1];var s=WB.min(g-o.BM,k.vL.length);h=k.BM+s;}else{h=0;}break;case lC.KeyCode.RIGHT:if(g<n){h=g+1;}break;case lC.KeyCode.DOWN:if(i>=0&&i<j.length-1){var o=j[i];var k=j[i+1];var s=WB.min(g-o.BM,k.vL.length);h=k.BM+s;}else{h=n;}break;case lC.KeyCode.DELETE:if(g<n){vL=l.substring(0,g)+l.substring(g+1);h=g;}break;}if(h!=-1){XN=h;nN=0.0;OP=true;}}}pP( j){if(EN==xC.ND){var i=vL.length;var h=XN;var g=j.text;if(g=='\r')g='\n';if(g=='\n'&&WO==false)g='';if(g=='')return;if(BP!=0&&i>=BP)return;vL=vL.substring(0,h)+g+vL.substring(h);XN=XN+g.length;nN=0.0;OP=true;}}sP( n){var VB=n.lE.toDouble();var l=n.mE.toDouble();if(HN==null)return;HN.setTransform(1.0,0.0,0.0,1.0,0.0,0.0);for(int i=0;i<JP.length;i++ ){var g=JP[i];if(g is !KD)continue;var m=g.vL;var RB=g.qL;var v=g.uL-g.GN;var GB=g.uL+g.TN;if(v<=l&&GB>=l){var o=double.INFINITY;var j=0;for(var h=0;h<=m.length;h++ ){var s=HN.measureText(m.substring(0,h)).width.toDouble();var k=(RB+s-VB).abs();if(k<o){o=k;j=h;}}XN=g.BM+j;nN=0.0;OP=true;}}}}class t extends BB{static const  fC="click";static const  EH="doubleClick";static const  hD="mouseDown";static const  ZE="mouseUp";static const  XF="mouseMove";static const  jD="mouseOut";static const  cF="mouseOver";static const  dF="mouseWheel";static const  jF="middleClick";static const  bH="middleMouseDown";static const  fH="middleMouseUp";static const  kF="rightClick";static const  kH="rightMouseDown";static const  mH="rightMouseUp";var PP,QP;var SP,TP;var jP;var kN;var PO;var sN;var AO;var qP;var rP;var tP;t( g,[ h=false]):super(g,h){dP(g,h);} dP( g,[ h=false]){super.dP(g,h);PP=QP=0;SP=TP=0;jP=false;kN=false;PO=false;sN=false;AO=false;qP=0;rP=0;tP=0;}set vP( g){PP=g.x;QP=g.y;}set wP( g){SP=g.x;TP=g.y;} get lE=>PP; get mE=>QP; get ZC=>jP; get altKey=>kN; get ctrlKey=>sN; get shiftKey=>AO; get SD=>qP; get deltaX=>rP; get deltaY=>tP;}class xC{static const  vG="dynamic";static const  ND="input";}class bD{var font;var size;var color;var bold;var italic;var underline;var align;var topMargin;var leftMargin;var rightMargin;var indent;var leading;bD(this.font,this.size,this.color,{this.bold: false,this.italic: false,this.underline: false,this.align: "left",this.topMargin: 0.0,this.leftMargin: 0.0,this.rightMargin: 0.0,this.indent: 0.0,this.leading: 0.0}); clone(){return new bD(font,size,color,bold:bold,italic:italic,underline:underline,align:align,topMargin:topMargin,leftMargin:leftMargin,rightMargin:rightMargin,indent:indent,leading:leading);}}class DC{static const  VC="center";static const  BH="end";static const  HH="justify";static const  eF="right";}class KD{var vL;var BM;var qL=0.0;var uL=0.0;var CM=0.0;var OM=0.0;var GN=0.0;var TN=0.0;var bN=0.0;KD.nJ(this.vL,this.BM); get x=>qL; get y=>uL; get width=>CM; get height=>OM; get pD=>GN; get jE=>TN; get leading=>bN;}class JD extends BB{static const  JF="textInput";var vL="";JD( g,[ h=false]):super(g,h); get text=>vL;}class oC{static var EF=vB.UE;static var zG=false;static var OF=null;static var LH=null;static var OH=null;static var TH=new ZB.StreamController<String>();static var XH=TH.stream.asBroadcastStream();static  rF( i){var h=i;var g="auto";if(EF!=vB.UE){h=EF;}switch (h){case vB.UE:g="auto";break;case vB.WE:g="default";break;case vB.XE:g="pointer";break;case vB.MH:g="move";break;case vB.UF:g="text";break;case vB.PH:g="wait";break;}if(zG){g="none";}return g;}}class PE{var sL;var HM;var RM;var eM;var SN;var fN;var pN;var BO;PE(){sL=new MB();HM=new List<YC>();RM=-1;SN=false;fN=new NF(0);pN=new aF();BO=new gF();eM=zO;DP();} get TD=>sL;DP(){lC.window.requestAnimationFrame(eM);}zO( g){DP();g=g.toDouble();if(RM==-1)RM=g;if(RM>g)RM=g;var j=g-RM;var i=j/1000.0;var k=g/1000.0;var l=false;if(j>=1){RM=g;fN.MN=i;lF.dispatchEvent(fN);sL.AC(i);for(int h=0;h<HM.length;h++ ){HM[h].TD.AC(i);}if(SN){SN=false;qF.dispatchEvent(BO);}for(int h=0;h<HM.length;h++ ){HM[h].eI(k,i);}nF.dispatchEvent(pN);}} LI( g){if(g.pE!=null){g.pE.sI(g);}HM.add(g);g.JQ=this;} sI( g){if(g.pE==this){HM.remove(g);g.JQ=null;}}}class vB{static const  UE="auto";static const  WE="arrow";static const  XE="button";static const  MH="hand";static const  UF="ibeam";static const  PH="wait";}class UC extends BB{static const  IF="keyDown";static const  KF="keyUp";var kN=false;var sN=false;var AO=false;var IO=false;var PO=false;var XO=0;var cO=0;var gO=0;UC( g,[ h=false]):super(g,h); get altKey=>kN; get ctrlKey=>sN; get shiftKey=>AO; get charCode=>XO; get keyCode=>cO; get keyLocation=>gO;}class rC{static const  wG="json";static const  BD="jsonarray";}class FB extends NC{final  fM=new Map<String,ME>();static const  NH=const uB<BB>(BB.pF); get onProgress=>FB.NH.forTarget(this);fO( i, g, k, l){var j="${i}.${g}";var h=new ME(i,g,k,l);if(fM.containsKey(j)){throw new StateError("ResourceManager already contains a resource called '${g}'");}else{fM[j]=h;}h.complete.then((VP){this.dispatchEvent(new BB(BB.pF));});} XP( i, h){var j="${i}.${h}";var g=fM[j];if(g==null){throw new StateError("Resource '${h}' does not exist.");}else if(g.value!=null){return g.value;}else if(g.error!=null){throw g.error;}else{throw new StateError("Resource '${h}' has not finished loading yet.");}} load(){var i=this.oI.map((h)=>h.complete);return ZB.Future.wait(i).then((j){var g=this.FG.length;if(g>0){throw new StateError("Failed to load ${g} resource(s).");}else{return this;}});} get oI{return fM.values.where((g)=>g.value==null&&g.error==null).toList();} get FG{return fM.values.where((g)=>g.error!=null).toList();} nB( h, g,[ i=null]){fO("BitmapData",h,g,DB.DD(g,i));} aB( i, g,[ h=null]){fO("Sound",i,g,dB.DD(g,h));} RD( i, g, h){fO("TextureAtlas",i,g,iB.DD(g,h));} zB( h, g){fO("Text",h,"",new ZB.Future.value(g));} AB( h){var g=XP("BitmapData",h);if(g is !DB)throw "dart2js_hint";return g;} pB( h){var g=XP("Sound",h);if(g is !dB)throw "dart2js_hint";return g;} bC( h){var g=XP("TextureAtlas",h);if(g is !iB)throw "dart2js_hint";return g;} ED( h){var g=XP("Text",h);if(g is !String)throw "dart2js_hint";return g;}}class ME{var zL;var MM;var UM;var dM=null;var nM=null;var wM=new ZB.Completer();ME( h, i, j, k):zL=h,MM=i,UM=j{k.then((g){dM=g;}).catchError((l){nM=l;}).whenComplete((){wM.complete(this);});} toString()=>"ResourceManagerResource [kind=${zL}, name=${MM}, url = ${UM}]"; get kind=>zL; get name=>MM; get value=>dM; get error=>nM; get complete=>wM.future;}class iB{final  JM=new List<BF>();var FM;static  DD( n, VB){var k=new ZB.Completer<iB>();var g=new iB();switch (VB){case rC.wG:case rC.BD:lC.HttpRequest.getString(n).then((GB){var o=EJ.parse(GB);var h=o["frames"];var s=o["meta"];var dC=uH(n,s["image"]);if(h is List){for(var v in h){var j=v as Map;var i=j["filename"] as String;var l=sF(i);var m=new BF.pJ(g,l,j);g.JM.add(m);}}if(h is Map){for(String i in h.keys){var j=h[i] as Map;var l=sF(i);var m=new BF.pJ(g,l,j);g.JM.add(m);}}DB.DD(dC).then(( lB){g.FM=lB;k.complete(g);}).catchError((RB){k.completeError(new StateError("Failed to load image."));});}).catchError((RB){k.completeError(new StateError("Failed to load json file."));});break;}return k.future;} AB( h){for(int g=0;g<JM.length;g++ ){var i=JM[g];if(i.name==h){return new DB.tJ(i);}}throw new ArgumentError("TextureAtlasFrame not found: '${h}'");}}class CF{final  sE;CF(this.sE);call( h, g){AN(h).bB(g);} get x=>AN("x"); get y=>AN("y"); get kB=>AN("scaleX"); get rB=>AN("scaleY"); get skewX=>AN("skewX"); get skewY=>AN("skewY"); get RC=>AN("pivotX"); get SC=>AN("pivotY"); get TB=>AN("rotation"); get alpha=>AN("alpha"); AN( h){var g=new yB(h);this.sE.AN(g);return g;}}class BF{final  EM;final  MM;final  iM;final  rM;final  CN;final  RN;final  ZN;final  iN;final  oN;final  vN;final  GO;BF.pJ( i, h, g):EM=i,MM=h,iM=gH(g["rotated"]),rM=EC(g["sourceSize"]["w"]),CN=EC(g["sourceSize"]["h"]),RN=EC(g["spriteSourceSize"]["x"]),ZN=EC(g["spriteSourceSize"]["y"]),iN=EC(g["frame"]["x"]),oN=EC(g["frame"]["y"]),vN=EC(g["frame"]["w"]),GO=EC(g["frame"]["h"]); get xI=>EM; get name=>MM; get uI=>iM; get WI=>iN; get XI=>oN; get HG=>vN; get GG=>GO; get offsetX=>RN; get offsetY=>ZN; get nI=>rM; get mI=>CN;}class rG<MD>{final  yL=new List<MD>();final  XM;var kM=0;rG( g()):XM=g; OG(){if(kM==0){return XM();}else{kM-- ;return yL[kM];}}QG( g){if(kM==yL.length){yL.add(g);}else{yL[kM]=g;}kM++ ;}reset(){yL.clear();kM=0;}}class BB{static const  xG="added";static const  CD="addedToStage";static const  QF="enterFrame";static const  WF="exitFrame";static const  SH="removed";static const  PD="removedFromStage";static const  YH="resize";static const  fF="render";static const  pF="progress";var EN;var eP;var fP;var aM;var hP;var iP;var lP;BB( g,[ h=false]){dP(g,h);} dP( g,[ h=false]){EN=g;eP=h;fP=qC.eD;aM=null;hP=null;iP=false;lP=false;} get zD=>iP; get type=>EN; get bubbles=>eP; get qD=>true; get target=>aM;}class DF{static const  bE="none";static const  IH="touchPoint";}class wC<MD extends BB> extends ZB.Stream<MD>{final  aM;final  QM;final  tM;var PN=[] ;wC(this.aM,this.QM,this.tM); get isBroadcast=>true; asBroadcastStream({ onListen( subscription), onCancel( subscription)})=>this; get uO=>PN.length>0; listen( i( event),{ onError(error), onDone(), cancelOnError: false}){var h=new GF<MD>(this,i);PN.add(h);if(tM==false){var g=this;switch (QM){case BB.QF:lF.gE(g);break;case BB.WF:nF.gE(g);break;case BB.fF:qF.gE(g);break;}}return h;}QI( j){if(j.JN)return;var i=[] ;for(var g=0;g<PN.length;g++ ){var h=PN[g];if(identical(h,j)){h.JN=true;}else{i.add(h);}}PN=i;}dispatchEvent( j){var k=PN;var i=PN.length;for(var g=0;g<i;g++ ){var h=k[g];if(h.JN==false){h.mN(j);}}}}class uB<MD extends BB>{final  QM;const uB(this.QM); forTarget( g,{ useCapture: false}){return g.eN(QM,useCapture);}}class NC{var GM;var hM; OB( g, h(event),{ useCapture: false}){return eN(g,useCapture).listen(h);}dispatchEvent( g){HP(g,this,this,qC.eD);} kP( h, j, i){if(j&&hM!=null){var g=hM[h];if(g!=null&&g.uO)return true;}if(i&&GM!=null){var g=GM[h];if(g!=null&&g.uO)return true;}return false;} eN( h, g){if(g){if(hM==null)hM=new Map<String,wC>();}else{if(GM==null)GM=new Map<String,wC>();}var i=g?hM:GM;return i.putIfAbsent(h,(){return new wC(this,h,g);});}HP( g, k, l, j){var h=(j==qC.FF)?hM:GM;if(h==null)return;var i=h[g.type];if(i==null)return;g.aM=k;g.hP=l;g.fP=j;g.iP=false;g.lP=false;i.dispatchEvent(g);}}class oG{static const  bE="none";}class yC{final  matrix=new IB.qJ();var alpha=1.0;var rD=fD.gD;var NN; get hI{if(NN==null)NN=new yC();return NN;}}class DB implements NE{var CM;var OM;var cM;var mM;var sM;var DN;var ON;var YN;var jN;var qN;var xN;var DO;var JO;var MO;var TO;var HN;static var hF=new KE();DB( i, l,[ j=true, g=0xFFFFFFFF,k=1.0]){CM=EC(i);OM=EC(l);cM=j;mM=k.toDouble();sM=mM/mD;DN=((1.0-sM).abs()<0.001)?0:1;jN=0;qN=0;ON=CM;YN=OM;xN=0;DO=0;JO=(CM*sM).ceil();MO=(OM*sM).ceil();var h=new lC.CanvasElement(width:JO,height:MO);TO=h;HN=h.context2D;HN.fillStyle=cM?ZF(g):OD(g);HN.fillRect(0,0,JO,MO);}DB.sJ( g,[ j=1.0]){var h=EC(g.naturalWidth);var i=EC(g.naturalHeight);cM=true;mM=oH(j);sM=mM;CM=(h/mM).round();OM=(i/mM).round();DN=((1.0-sM).abs()<0.001)?0:1;jN=0;qN=0;ON=CM;YN=OM;xN=0;DO=0;JO=h;MO=i;TO=g;}DB.tJ( g){var h=g.xI.FM;CM=g.nI.toInt();OM=g.mI.toInt();cM=true;mM=h.mM;sM=h.sM;DN=g.uI?3:2;jN=g.offsetX;qN=g.offsetY;ON=g.HG;YN=g.GG;xN=(g.WI*sM).floor();DO=(g.XI*sM).floor();JO=(g.HG*sM).ceil();MO=(g.GG*sM).ceil();TO=h.TO;}static  DD( g,[ i=null, l=1.0]){if(i==null){i=DB.hF;}if(YC.dE&&i.autoHiDpi){if(g.contains("@1x.")&&nD>=1.5){l=l*2.0;g=g.replaceAll("@1x.","@2x.");}}var j=new ZB.Completer<DB>();var h=new lC.ImageElement();var k;var m;k=h.onLoad.listen((v){k.cancel();m.cancel();j.complete(new DB.sJ(h,l));});m=h.onError.listen((v){k.cancel();m.cancel();j.completeError(new StateError("Failed to load image."));});if(i.webp==false){h.src=g;return j.future;}BI.then(( o){var s=new RegExp(r"(png|jpg|jpeg)$",multiLine:false,caseSensitive:true);var n=s.firstMatch(g);if(o==false||n==null){h.src=g;}else{h.src=g.substring(0,g.length-n.group(1).length)+"webp";}});return j.future;} get width=>CM; get height=>OM; clone([ g]){g=(g!=null)?g:mM;var h=new DB(CM,OM,true,0,g);h.UI(this);return h;} UI( h,[ g=null]){mQ();g=(g==null)?new IB.qJ():g.clone();g.scale(sM,sM);var i=new xB.rJ(HN,g);h.hB(i);HN.globalAlpha=1.0;HN.globalCompositeOperation=fD.gD;} clear(){mQ();HN.setTransform(sM,0.0,0.0,sM,0.0,0.0);HN.clearRect(0,0,CM,OM);} hB( h){var g=h.context;switch (DN){case 0:g.drawImage(TO,jN,qN);break;case 1:g.drawImageScaled(TO,jN,qN,ON,YN);break;case 2:g.drawImageScaledFromSource(TO,xN,DO,JO,MO,jN,qN,ON,YN);break;case 3:g.transform(0.0,-1.0,1.0,0.0,jN,qN+YN);g.drawImageScaledFromSource(TO,xN,DO,MO,JO,0.0,0.0,YN,ON);break;}} RG( o, g){if(g.width==0||g.height==0)return;var i=o.context;if(DN!=0){mQ();}var h=(g.x-jN)*sM;var n=(g.y-qN)*sM;var s=g.width*sM;var k=g.height*sM;var l=g.x+jN;var j=g.y+qN;var v=g.width;var m=g.height;i.drawImageScaledFromSource(TO,h,n,s,k,l,j,v,m);} mQ(){if(HN==null){var g=mM/mD;var j=(CM*g).ceil();var i=(OM*g).ceil();var h=new lC.CanvasElement(width:j,height:i);var k=new IB(g,0.0,0.0,g,0.0,0.0);var l=new xB.rJ(h.context2D,k);this.hB(l);mM=mM;sM=g;DN=((1.0-sM).abs()<0.001)?0:1;jN=0;qN=0;ON=CM;YN=OM;xN=0;DO=0;JO=j;MO=i;TO=h;HN=h.context2D;}}}class SE extends dD implements mB{static const  AH='TIME_OUT';var IN=false;var VM=0.0;var jM=0.0;var tN;var zN=true;SE( g, i,[ h=dD.iD]):super(i,h){if(g<=0)throw new ArgumentError('Time must be greater than zero');jM=g;yF();} AC( g){if(IN&&ratio>0.0){ratio=ratio-g/FD;if(ratio==0.0)pause();}return true;} start(){IN=true;} pause(){IN=false;} reset([ g=0.0]){pause();g=WB.max(g,0.0);if(g!=0.0){jM=g;yF();}ratio=1.0;} oD( g, h){tN[g]=h/FD;} yF(){tN=new Map<String,num>();oD(SE.AH,0);} get FD=>jM; get tI=>ratio*FD; set ratio( i){var h=ratio;super.ratio=i;if(zN){tN.forEach((j,g){if(g<h&&g>=ratio)dispatchEvent(new BB(j));});}}}typedef  LD( ratio);typedef  sG<MD extends BB>( event);class GF<MD extends BB> extends ZB.StreamSubscription<MD>{var xM=0;var JN=false;var aN;var mN;GF(this.aN,this.mN); get isPaused=>xM>0; onError( g(error)){} cancel(){aN.QI(this);} pause([ g]){xM++ ;if(g!=null){g.whenComplete(resume);}} resume(){if(xM==0){throw new StateError("Subscription is not paused.");}xM-- ;}}class MB implements mB{var zM;var VN;var dN=0.0;MB(){zM=new OE();VN=zM;} add( g){if(g is !mB){throw new ArgumentError("The supplied animatable does not extend type Animatable.");}if(this.contains(g)==false){var h=new OE();VN.gC=g;VN.uC=h;VN=h;}} remove( h){if(h!=null){var g=zM;while (identical(g,VN)==false){if(identical(g.gC,h)){g.gC=null;break;}g=g.uC;}}} contains( h){if(h!=null){var g=zM;while (identical(g,VN)==false){if(identical(g.gC,h))return true;g=g.uC;}}return false;} sE( g, i,[ h]){var j=h!=null?new eB(g,i,h):new eB(g,i);add(j);return j;} jB( h, i){var g=new RE(h,i);add(g);return g;} AC( j){dN+= j;var g=zM;var i=VN;while (identical(g,i)==false){var k=g.gC;if(k==null){var h=g.uC;g.gC=h.gC;g.uC=h.uC;if(identical(h,i))i=g;if(identical(h,VN))VN=g;}else if(k.AC(j)==false){g.gC=null;}else{g=g.uC;}}return true;}}class fD{static const  gD="source-over";} OD( g){var h=(g>>16)&0xFF;var i=(g>>8)&0xFF;var j=(g>>0)&0xFF;return "rgb(${h},${i},${j})";} FH( g){if(TE.containsKey(g)==false){TE[g]=new aE(g);}return TE[g];}class NF extends cD{var MN;NF( g):super(BB.QF),MN=g;}class RF{static var aH=DF.bE;static var eH=new ZB.StreamController<String>();static var iH=eH.stream.asBroadcastStream();static  get pH=>aH;}class wB{static const  YF="B";static const  UH="BL";static const  bF="BR";static const  yG="L";static const  eF="R";static const  ZH="T";static const  dH="TR";static const  bE="";} ZF( g){var h=(g>>24)&0xFF;var i=(g>>16)&0xFF;var j=(g>>8)&0xFF;var k=(g>>0)&0xFF;return "rgba(${i},${j},${k},${h/255.0})";}class WC extends mB{final  QO;final  VO;final  bO;var iO;var kO;var oO;var rO;var jM;var VM;var xO;var AP;var CP;WC( h, i, j,[ g]):QO=h,VO=i,bO=(g!=null)?g:QB.XC{iO=h;VM=0.0;jM=WB.max(0.0001,j);xO=0.0;AP=false;CP=false;} AC( i){if(VM<jM||CP==false){VM=VM+i;if(VM>jM)VM=jM;if(VM>=0.0){if(CP==false){CP=true;if(kO!=null)kO();}var g=VM/jM;var h=bO(g);iO=QO+h*(VO-QO);if(oO!=null)oO(AP?iO.round():iO);if(rO!=null&&VM==jM)rO();}}return VM<jM;} get yD=>QO; get AE=>VO; get FD=>jM; get currentTime=>VM;set aC( g){if(CP==false)VM=VM+xO-g;xO=g;} set onStart( g()){kO=g;} set QC( g( value)){oO=g;} set onComplete( g()){rO=g;}}class aF extends cD{aF():super(BB.WF);}class xB{final  HN;var VM=0.0;var eO=0.0;var lO;var qO;xB.rJ( i,[ h]):HN=i{lO=new yC();qO=lO;var g=lO.matrix;if(h is IB){g.sD(h);}HN.setTransform(g.a,g.b,g.c,g.d,g.BC,g.CC);HN.globalAlpha=1.0;HN.globalCompositeOperation=fD.gD;} get context=>HN; get currentTime=>VM; get SI=>eO; reset([ i, h, j]){VM=(h is num)?h:0.0;eO=(j is num)?j:0.0;qO=lO;var g=lO.matrix;if(i is IB){g.sD(i);}HN.setTransform(1.0,0.0,0.0,1.0,0.0,0.0);HN.clearRect(0,0,HN.canvas.width,HN.canvas.height);HN.setTransform(g.a,g.b,g.c,g.d,g.BC,g.CC);HN.globalAlpha=1.0;HN.globalCompositeOperation=fD.gD;} SG( h){var g=h.bP;var GB=h.LO;var k=h.YO;var j=h.vO;var o=h.yO;var m=qO as yC;var i=qO.hI as yC;qO=i;var n=i.matrix;var v=m.alpha.toDouble()*GB;var s=(o!=null)?o:m.rD;n.iE(g,m.matrix);i.alpha=v;i.rD=s;if(k!=null){if(k.kC==null){g=i.matrix;}else if(identical(k.kC,h)){g=i.matrix;}else if(identical(k.kC,h.parent)){g=m.matrix;}else{g=k.kC.rE(h);if(g==null)g=eE;else g.concat(i.matrix);}k.MI(this,g);}if(j!=null){if(j.kC==null){g=i.matrix;}else if(identical(j.kC,h)){g=i.matrix;}else if(identical(j.kC,h.parent)){g=m.matrix;}else{g=j.kC.rE(h);if(g==null)g=eE;else g.concat(i.matrix);}j.YJ(this,g);}var l=n;HN.setTransform(l.a,l.b,l.c,l.d,l.BC,l.CC);HN.globalCompositeOperation=s;HN.globalAlpha=v;if(h.OI){h.dQ(this);}else{h.hB(this);}if(j!=null){j.aJ();}if(k!=null){k.VI();}qO=m;}}class gF extends cD{gF():super(BB.fF);}class aE{var fontStyle;var pD=0;var jE=0;var height=0;aE( j){this.fontStyle=j;var h=new lC.Element.tag("span");h.style.font=this.fontStyle;h.text="Hg";var g=new lC.Element.tag("div");g.style.display="inline-block";g.style.width="1px";g.style.height="0px";var i=new lC.Element.tag("div");i.append(g);i.append(h);lC.document.body.append(i);try {g.style.verticalAlign="baseline";this.pD=g.offsetTop-h.offsetTop;g.style.verticalAlign="bottom";this.height=g.offsetTop-h.offsetTop;this.jE=height-pD;}catch (k){}finally {i.remove();}}}class QB{static  XC( g){return g;}static  tF( g){return g*g*g;}static  FC( g){g=1.0-g;return 1.0-g*g*g;}static  JI( g){if(g==0.0||g==1.0)return g;return WB.pow(2.0,-10.0*g)*WB.sin((g-0.3/4.0)*(2.0*WB.PI)/0.3)+1;}}class QD{static const  UE="auto";static const  jH="stop";static const  mF="once";} gH( g){if(g is bool){return g;}else{throw new ArgumentError("The supplied value (${g}) is not a bool.");}}final  lF=new cE<NF>();final  nF=new cE<aF>(); EC( g){if(g is int){return g;}else{throw new ArgumentError("The supplied value (${g}) is not an int.");}}class oF{var target=null;var ZC=false;var hE=0;var SD=0;var LG,MG;var JG,KG;oF(this.LG,this.MG,this.JG,this.KG);}final  qF=new cE<gF>(); oH( g){if(g is num){return g;}else{throw new ArgumentError("The supplied value (${g}) is not a number.");}}class cE<MD extends cD>{final  GM=[] ;gE( g){GM.add(g);}dispatchEvent( g){var j=GM;var k=GM.length;for(int h=0;h<k;h++ ){var i=j[h];if(i.uO){g.aM=i.aM;g.hP=i.aM;g.fP=qC.eD;g.iP=false;g.lP=false;i.dispatchEvent(g);}else{j.removeAt(h);k-- ;h-- ;}}}}class yB{final  nE;var yD=double.NAN;var AE=double.NAN;yB(this.nE); bB( g){this.AE=g.toDouble();} get cI=>!yD.isNaN&&!AE.isNaN; oP( g){switch (nE){case 'x':return g.x;case 'y':return g.y;case 'pivotX':return g.RC;case 'pivotY':return g.SC;case 'scaleX':return g.kB;case 'scaleY':return g.rB;case 'skewX':return g.skewX;case 'skewY':return g.skewY;case 'rotation':return g.TB;case 'alpha':return g.alpha;default:return 0.0;}} CQ( g, h){switch (nE){case 'x':g.x=h;break;case 'y':g.y=h;break;case 'pivotX':g.RC=h;break;case 'pivotY':g.SC=h;break;case 'scaleX':g.kB=h;break;case 'scaleY':g.rB=h;break;case 'skewX':g.skewX=h;break;case 'skewY':g.skewY=h;break;case 'rotation':g.TB=h;break;case 'alpha':g.alpha=h;break;}}}class qH{static var rH=0;var BE=rH++ ;var target=null;var wD=false;qH(this.target,this.wD);} sF( g){var h=new RegExp(r"(.+?)(\.[^.]*$|$)",multiLine:false,caseSensitive:false);var i=h.firstMatch(g);return i.group(1);}class XJ extends JE{final  uP;XJ( i, g, h, j):uP=new HB(i,g,h,j);cP(){HN.rect(uP.x,uP.y,uP.width,uP.height);}}class YC extends pC{static var dE=II;var WP;var HN;var yP,AQ;var BQ;var DQ,FQ;var GQ;var HQ;var IQ;var JQ;var sL;var KQ;var LQ;var MQ;var NQ;var OQ;var PQ;var QQ;var RQ;var SQ;var TQ;var UQ;var VQ;YC( k, g,[ j, i, h]){if(g is !lC.CanvasElement){throw new ArgumentError("The canvas argument is not a CanvasElement");}if(g.tabIndex==-1)g.tabIndex=0;if(g.style.outline=="")g.style.outline="none";MM=k;WP=g;HN=g.context2D;yP=(j!=null)?j:g.width;AQ=(i!=null)?i:g.height;BQ=(h!=null)?h:30;DQ=-1;FQ=-1;GQ=new HB.mJ();HQ=new IB.qJ();IQ=new IB.qJ();bQ();JQ=null;sL=new MB();LQ=new xB.rJ(HN);MQ=QD.UE;NQ=ID.TF;OQ=wB.bE;SQ=[new oF(t.hD,t.ZE,t.fC,t.EH),new oF(t.bH,t.fH,t.jF,t.jF),new oF(t.kH,t.mH,t.kF,t.kF)];PQ=vB.WE;RQ=null;QQ=new LB(0,0);UQ=new t(t.fC,true);oC.XH.listen(XH);WP.onMouseDown.listen(UO);WP.onMouseUp.listen(UO);WP.onMouseMove.listen(UO);WP.onMouseOut.listen(UO);WP.onMouseWheel.listen(eQ);TQ=new Map<int,qH>();VQ=new YB(YB.HF,true);RF.iH.listen(fQ);fQ(null);WP.onKeyDown.listen(gQ);WP.onKeyUp.listen(gQ);WP.onKeyPress.listen(gQ);} get pE=>JQ; get TD=>sL; get vD=>QQ; get focus=>KQ; get align=>OQ;iQ(){throw new UnsupportedError("Error #2071: The Stage class does not implement this property or method.");}set x( g){iQ();}set y( g){iQ();}set RC( g){iQ();}set SC( g){iQ();}set kB( g){iQ();}set rB( g){iQ();}set skewX( g){iQ();}set skewY( g){iQ();}set TB( g){iQ();}set alpha( g){iQ();}set width( g){iQ();}set height( g){iQ();}eI( g, h){if(MQ==QD.UE||MQ==QD.mF){bQ();LQ.reset(IQ,g,h);hB(LQ);if(MQ==QD.mF)MQ=QD.jH;}}bQ(){var RB=WP.getBoundingClientRect();var lB=WP.clientLeft+RB.left;var VB=WP.clientTop+RB.top;var h=WP.clientWidth;var j=WP.clientHeight;var o=yP;var GB=AQ;if(h is !num)throw "dart2js_hint";if(j is !num)throw "dart2js_hint";if(o is !num)throw "dart2js_hint";if(GB is !num)throw "dart2js_hint";if(h==0||j==0)return;var i=1.0;var g=1.0;var k=0.0;var m=0.0;var n=h/o;var l=j/GB;switch (NQ){case ID.uG:i=n;g=l;break;case ID.CH:i=g=(n>l)?n:l;break;case ID.KH:i=g=1.0;break;case ID.TF:i=g=(n<l)?n:l;break;}switch (OQ){case wB.dH:case wB.eF:case wB.bF:k=(h-o*i);break;case wB.ZH:case wB.bE:case wB.YF:k=(h-o*i)/2;break;}switch (OQ){case wB.UH:case wB.YF:case wB.bF:m=(j-GB*g);break;case wB.yG:case wB.bE:case wB.eF:m=(j-GB*g)/2;break;}var s=GQ;s.x=-k/i;s.y=-m/g;s.width=h/i;s.height=j/g;var v=(YC.dE?nD:1.0)/mD;IQ.xD(i,0.0,0.0,g,k,m);IQ.scale(v,v);HQ.xD(1.0,0.0,0.0,1.0,-lB-k,-VB-m);HQ.scale(1.0/i,1.0/g);if(DQ!=h||FQ!=j){DQ=h;FQ=j;WP.width=(DQ*v).round();WP.height=(FQ*v).round();if(WP.clientWidth!=h||WP.clientHeight!=j){WP.style.width="${h}px";WP.style.height="${j}px";}dispatchEvent(new BB(BB.YH));}}XH( g){WP.style.cursor=oC.rF(PQ);}UO( j){j.preventDefault();var n=new DateTime.now().millisecondsSinceEpoch;var s=j.button;var g=null;var i=HQ.zP(j.client);var m=null;if(s<0||s>2)return;if(j.type=="mousemove"&&QQ.EG(i))return;var h=SQ[s];QQ=i;if(oC.OF!=null)oC.OF.gP();if(j.type!="mouseout")g=qB(i.x,i.y) as PB;var k=vB.WE;if(g is EB&&(g as EB).tE){k=vB.XE;}if(g is vC&&(g as vC).tE){k=vB.XE;}if(g is LC&&(g as LC).type==xC.ND){k=vB.UF;}if(PQ!=k){PQ=k;WP.style.cursor=oC.rF(k);}if(RQ!=null&&RQ!=g){RQ.dispatchEvent(UQ..dP(t.jD,true)..vP=(RQ.cC!=null)?RQ.jC(i):new LB.mJ()..wP=i..jP=h.ZC);RQ=null;}if(g!=null&&g!=RQ){g.dispatchEvent(UQ..dP(t.cF,true)..vP=g.jC(i)..wP=i..jP=h.ZC);RQ=g;}var l=null;var o=false;var v=false;if(j.type=="mousedown"){WP.focus();l=h.LG;if(g!=h.target||n>h.hE+500)h.SD=0;h.ZC=true;h.target=g;h.hE=n;h.SD++ ;}if(j.type=="mouseup"){l=h.MG;h.ZC=false;o=(h.target==g);v=o&&h.SD.isEven&&(n<h.hE+500);}if(j.type=="mousemove"){l=t.XF;}if(l!=null&&g!=null){m=g.jC(i);g.dispatchEvent(UQ..dP(l,true)..vP=m..wP=i..jP=h.ZC..qP=h.SD);if(o){if(v&&g.TI){g.dispatchEvent(UQ..dP(h.KG,true)..vP=m..wP=i..jP=h.ZC);}else{g.dispatchEvent(UQ..dP(h.JG,true)..vP=m..wP=i..jP=h.ZC);}}}}eQ( h){var g=HQ.zP(h.client);var i=qB(g.x,g.y) as PB;if(i!=null){i.dispatchEvent(UQ..dP(t.dF,true)..vP=i.jC(g)..wP=g..rP=h.deltaX..tP=h.deltaY);if(UQ.zD)h.preventDefault();}}var nQ=[] ;fQ( h){nQ.forEach((g)=>g.cancel());if(RF.pH==DF.IH){nQ=[WP.onTouchStart.listen(oQ),WP.onTouchEnd.listen(oQ),WP.onTouchMove.listen(oQ),WP.onTouchEnter.listen(oQ),WP.onTouchLeave.listen(oQ),WP.onTouchCancel.listen(oQ)];}}oQ( j){j.preventDefault();for(var m in j.changedTouches){var l=m.identifier;var i=HQ.zP(m.client);var h=qB(i.x,i.y) as PB;var g=TQ.containsKey(l)?TQ[l]:new qH(h,TQ.length==0);if(g.target!=null&&g.target!=h){g.target.dispatchEvent(VQ..dP(YB.VH,true)..vP=(g.target.cC!=null)?g.target.jC(i):new LB.mJ()..wP=i..KP=g.BE..NP=g.wD);g.target=null;}if(h!=null&&h!=g.target){h.dispatchEvent(VQ..dP(YB.RH,true)..vP=h.jC(i)..wP=i..KP=g.BE..NP=g.wD);g.target=h;}var k=null;if(j.type=="touchstart"){WP.focus();TQ[l]=g;k=YB.HF;}if(j.type=="touchend"){TQ.remove(l);k=YB.LF;}if(j.type=="touchcancel"){TQ.remove(l);k=YB.PF;}if(j.type=="touchmove"){k=YB.VF;}if(k!=null&&h!=null){h.dispatchEvent(VQ..dP(k,true)..vP=h.jC(i)..wP=i..KP=g.BE..NP=g.wD);}}}gQ( g){if(g.keyCode==8){g.preventDefault();}if(KQ==null){return;}if(g.type=="keypress"){var j=g.charCode;var k=g.keyCode;if(k==13)j=13;if(j==0)return;var l=new JD(JD.JF,true)..vL=new String.fromCharCodes([j]);KQ.dispatchEvent(l);}else{var h=AD.tG;var i="";if(g.type=="keyup")i=UC.KF;if(g.type=="keydown")i=UC.IF;if(g.keyLocation==lC.KeyLocation.LEFT)h=AD.yG;if(g.keyLocation==lC.KeyLocation.RIGHT)h=AD.eF;if(g.keyLocation==lC.KeyLocation.NUMPAD)h=AD.JH;if(g.keyLocation==lC.KeyLocation.JOYSTICK)h=AD.SF;if(g.keyLocation==lC.KeyLocation.MOBILE)h=AD.SF;var m=new UC(i,true)..kN=g.altKey..sN=g.ctrlKey..AO=g.shiftKey..XO=g.charCode..cO=g.keyCode..gO=h;KQ.dispatchEvent(m);}}} uH( j, g){var i=new RegExp(r"^(.*/)?(?:$|(.+?)(?:(\.[^.]*$)|$))",multiLine:false,caseSensitive:false);var k=i.firstMatch(j);var h=k.group(1);return (h==null)?g:"${h}${g}";} xH(){var i=new ZB.Completer<bool>();var g=new lC.ImageElement(); h(){i.complete(g.width==2&&g.height==2);}g.onLoad.listen((j)=>h());g.onError.listen((j)=>h());g.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";return i.future;}class eB implements mB{final  XQ;final  bO;final  YQ=new List<yB>();var kO;var oO;var rO;var ZQ;var jM;var VM;var xO;var AP;var CP;eB( g, i,[ h=QB.XC]):XQ=g,bO=h{ZQ=new CF(this);VM=0.0;jM=WB.max(0.0001,i);xO=0.0;AP=false;CP=false;} get fB=>ZQ; AN( g){if(XQ!=null&&CP==false){YQ.add(g);}} complete(){if(jM>=VM)AC(jM-VM);} AC( m){if(VM<jM||CP==false){VM=VM+m;if(VM>jM){VM=jM;}if(VM>=0.0){if(CP==false){CP=true;for(int h=0;h<YQ.length;h++ ){var g=YQ[h];g.yD=g.oP(XQ);}if(kO!=null){kO();}}var k=VM/jM;var l=bO(k).toDouble();for(int h=0;h<YQ.length;h++ ){var g=YQ[h];if(g.cI){var i=g.yD.toDouble();var n=g.AE.toDouble();var j=i+l*(n-i);g.CQ(XQ,AP?j.round():j);}}if(oO!=null){oO();}if(rO!=null&&VM==jM){rO();}}}return VM<jM;} get FD=>jM; get currentTime=>VM;set aC( g){if(CP==false)VM=VM+xO-g;xO=g;} set onStart( g()){kO=g;} set QC( g()){oO=g;} set onComplete( g()){rO=g;}}final  BI=xH();final  lD=new rG<List<u>>(()=>new List<u>());final  eE=new IB.qJ(); fE( g, m, n, j){m=m.toDouble();n=n.toDouble();var dC=0.0;var lB=0.0;var v=m*g.a;var VB=m*g.b;var GB=m*g.a+n*g.c;var s=m*g.b+n*g.d;var RB=n*g.c;var o=n*g.d;var h=dC;if(h>v)h=v;if(h>GB)h=GB;if(h>RB)h=RB;var i=lB;if(i>VB)i=VB;if(i>s)i=s;if(i>o)i=o;var l=dC;if(l<v)l=v;if(l<GB)l=GB;if(l<RB)l=RB;var k=lB;if(k<VB)k=VB;if(k<s)k=s;if(k<o)k=o;if(j==null)j=new HB.mJ();j.x=g.BC+h;j.y=g.CC+i;j.width=l-h;j.height=k-i;return j;}final  CI=new lC.CanvasElement(width:16,height:16);final  vF=CI.context2D;final  mD=vF.backingStorePixelRatio==null?1.0:vF.backingStorePixelRatio.toDouble();final  nD=lC.window.devicePixelRatio==null?1.0:lC.window.devicePixelRatio;final  EI=((){var g=lC.window.navigator.userAgent.toLowerCase();return g.indexOf("iphone")>=0||g.indexOf("ipad")>=0||g.indexOf("ipod")>=0||g.indexOf("android")>=0||g.indexOf("webos")>=0||g.indexOf("windows phone")>=0;})();final  GI=lC.window.screen==null?1024:WB.max(lC.window.screen.width,lC.window.screen.height);final  II=nD>1.0&&(!EI||GI>480);
//# sourceMappingURL=escape.dart.map
//@ sourceMappingURL=escape.dart.map
