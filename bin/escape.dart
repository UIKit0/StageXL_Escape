import "dart:html" as aC;import "dart:web_audio" as cF;import "dart:math" as SB;import "dart:json" as cH;class bC{static var LB;}class u{static const  CD="None";static const  OB="Joker";static const  yB="Block";static const  RE="Double";static const  SE="Quint";}class eB{static var LB;}class dF extends AB{var NI;var XI;var hI;var nI;var qI;dF(){hI=eB.LB.iB("Warning");nI=null;NI=GB.qF();XI=new BB(NI[0]);n(XI);} start(){nI=hI.play();p.remove(qI);qI=new LC(0,80,9.0,MB.MC);qI.HC=(h){var g=h.toInt()%8;XI.PB=NI[(g<=4)?g+1:8-g];};p.add(qI);} stop(){if(nI!=null){nI.stop();nI=null;}p.remove(qI);XI.PB=NI[0];}}class fF extends AB{var tI;var AJ;var FJ;var JJ;var MJ;var NJ;var OJ;var PJ;var QJ;var SJ;var TJ;var UJ;var VJ;var WJ;var XJ;var ZJ;var aJ;var bJ;var cJ;var eJ;fF( v, s, IB, m, o, EB, k){PJ=new SB.Random();QJ=xB.sC;SJ=k;tI=v;AJ=s;FJ=IB;JJ=m;MJ=o;NJ=EB;OJ=k.length;WJ=new List<NB>();ZJ=new AB();aJ=new AB();bJ=new AB();cJ=new AB();eJ=new AB();n(ZJ);n(aJ);n(bJ);n(cJ);n(eJ);aJ.UB=false;bJ.UB=false;cJ.UB=false;eJ.UB=false;DH();EH();CH();XJ=true;var l=new rC();this.mask=new rF.AI(0.0,0.0,500.0,500.0);for(int g=0;g<10;g++ ){for(int h=0;h<10;h++ ){var i=UJ[g+h*10];i.x=g*50+25;i.y=h*50+25-550;i.jB(ZJ,aJ,bJ);var j=new LC(i.y,h*50+25,0.4,MB.sB);j.delay=g*0.03;j.HC=(RB){i.y=RB;};j.onComplete=(){if(l.WD()==100){lJ();XJ=false;WJ.clear();this.mask=null;}};p.add(j);}}addEventListener(t.MD,mJ);} aF( g){if(g==xB.dD)QJ=g;if(g==xB.eD&&QJ==xB.sC){QJ=g;if(XJ==false)KB(new cB(cB.gD,null));}} FF(){this.mask=new rF.AI(0.0,0.0,500.0,500.0);for(int h=0;h<10;h++ ){for(int i=0;i<10;i++ ){var g=UJ[i+h*10];g.dB=false;g.GC=false;g.FB=u.CD;g.jB(ZJ,aJ,bJ);var j=new LC(g.y,500+h*50+25,0.5,MB.sB);j.delay=i*0.1;j.HC=(k){g.y=k;};p.add(j);}}} DH(){VJ=new List<BD>();for(int h=0;h<AJ;h++ ){var g=new BD(h);g.XB=(PJ.nextInt(30)-15)*SB.PI/180;g.x=300-(90*AJ)/2+h*90+PJ.nextInt(20)-10;g.y=550;VJ.add(g);cJ.n(g);}} CF( g, h){var i=0;var j=UJ[g+h*10];if(j.direction==0){var l=(g>0)?UJ[g-1+h*10]:null;var m=(g<9)?UJ[g+1+h*10]:null;if(j.WC(l))i++ ;if(j.WC(m))i++ ;}else{var k=(h>0)?UJ[g+(h-1)*10]:null;var o=(h<9)?UJ[g+(h+1)*10]:null;if(j.fC(k))i++ ;if(j.fC(o))i++ ;}return i;} BF(){for(int h=0;h<10;h++ ){for(int g=0;g<10;g++ ){var k=UJ[g+h*10];var i=OJ*2;while (CF(g,h)==2&&i>0){if(i%2==0){k.direction=1-k.direction;i-- ;}else{var m=0;for(int j=0;j<SJ.length;j++ )if(k.color==SJ[j])m=j;k.color=SJ[(m+1)%SJ.length];i-- ;}}}}var l=false;for(int h=0;h<10;h++ )for(int g=0;g<10;g++ )l=l||(CF(g,h)==2);return l;} RF(){for(int g=0;g<10;g++ )for(int h=1;h<9;h++ )if(UJ[(h-1)+g*10].TD(UJ[h+g*10])&&UJ[h+g*10].TD(UJ[(h+1)+g*10]))return true;for(int h=0;h<10;h++ )for(int g=1;g<9;g++ )if(UJ[h+(g-1)*10].TD(UJ[h+g*10])&&UJ[h+g*10].TD(UJ[h+(g+1)*10]))return true;return false;} sJ( k, l, j){for(int h=0;h<20;h++ ){var g=tI~/j;var i=l*g+PJ.nextInt(g);if(TJ[i].FB==u.CD){TJ[i].FB=k;return;}}} EH(){TJ=new List<JB>();for(int g=0;g<tI;g++ ){var i=SJ[PJ.nextInt(SJ.length)];var h=PJ.nextInt(2);TJ.add(new JB(i,h));}for(int g=0;g<AJ*2;g++ )sJ("Lock${(g%AJ)+1}",g,AJ*2);for(int g=0;g<FJ;g++ )sJ(u.OB,g,FJ);for(int g=0;g<JJ;g++ )sJ(u.yB,g,JJ);for(int g=0;g<MJ;g++ )sJ(u.RE,g,MJ);for(int g=0;g<NJ;g++ )sJ(u.SE,g,NJ);} CH(){UJ=new List<JB>();var g=true;while (g){UJ.clear();for(int h=0;h<100;h++ ){var j=SJ[PJ.nextInt(SJ.length)];var i=PJ.nextInt(2);UJ.add(new JB(j,i));}g=BF();}} WF(){if(XJ||QJ!=xB.sC)return false;var l=true;XJ=true;while (l){for(int k=0;k<UJ.length;k++ ){var g=UJ[k];g.dB=false;g.GC=false;g.jB(ZJ,aJ,bJ);g.color=SJ[PJ.nextInt(SJ.length)];g.direction=PJ.nextInt(2);}l=BF()||(RF()==false);}var s=eB.LB.iB("BonusUniversal");s.play();var m=new rC();for(int i=0;i<10;i++ ){for(int j=0;j<10;j++ ){var g=UJ[i+j*10];g.XF=0.0;var h=new LC(0.0,1.0,0.2,MB.MC);h.delay=i*0.06;h.HC=(o){g.XF=o;};h.PF=(){g.jB(ZJ,aJ,bJ);};h.onComplete=(){if(m.WD()==100){lJ();tJ();WJ.clear();}};p.add(h);}}return true;} lJ(){for(int i=0;i<10;i++ ){for(int h=0;h<10;h++ ){var g=UJ[h+i*10];var l=(h<9)?UJ[h+1+i*10]:null;var m=(i<9)?UJ[h+(i+1)*10]:null;var j=false;var k=false;if(g.WC(l)){j=true;k=(g.FB==u.OB||l.FB==u.OB);}if(g.fC(m)){j=true;k=(g.FB==u.OB||m.FB==u.OB);}if(g.dB!=j||g.GC!=k){g.dB=j;g.GC=k;g.jB(ZJ,aJ,bJ);}}}} vJ( o, l, s, k, m, v){XJ=true;o.WD(k);var i=1;for(int h=0;h<k;h++ ){var g=UJ[l+h*m+(s+h*v)*10];if(g.FB==u.RE)i=i*2;if(g.FB==u.SE)i=i*5;var IB=l+h*m;var RB=s+h*v;p.fB((){g.empty=true;g.jB(ZJ,aJ,bJ);var EB=eB.LB.iB("ChainBlast");EB.play();var j=new PE(g.color,g.direction);j.x=IB*50;j.y=RB*50;p.add(j);eJ.n(j);PH(g);if(o.DF()==0)xJ();},0.1+h*0.1);}KB(new cB(cB.PE,{"Length":k,"Factor":i}));} tJ(){XJ=false;var j=new rC();for(int h=0;h<10;h++ ){for(int i=0;i<10;){var g=1;while (i+g<10&&UJ[i+g-1+h*10].WC(UJ[i+g+h*10]))g++ ;if(g>=3)vJ(j,i,h,g,1,0);i=i+g;}}for(int i=0;i<10;i++ ){for(int h=0;h<10;){var g=1;while (h+g<10&&UJ[i+(h+g-1)*10].fC(UJ[i+(h+g)*10]))g++ ;if(g>=3)vJ(j,i,h,g,0,1);h=h+g;}}if(j.value==0){if(QJ==xB.dD)KB(new cB(cB.QE,null));if(QJ==xB.eD)KB(new cB(cB.gD,null));if(QJ==xB.sC&&RF()==false)WF();}} PH( h){if(h.FB.indexOf("Lock")==0){var k=int.parse(h.FB.substring(4,5))-1;var j=VJ[k];var g=GB.hD(h.FB);g.x=h.x;g.y=h.y;n(g);var i=new mB(g,0.5,MB.sB);i.WB("x",j.x);i.WB("y",j.y-10);i.onComplete=()=>uB(g);p.add(i);p.fB(()=>KH(k),0.5);}} KH( k){var h=VJ[k];var i;if(h.AD){i=new cB(cB.DD,{"Type":"SingleLocked","Position":new NB(h.x+20,h.y)});var m=eB.LB.iB("Unlock");m.play();}else{i=new cB(cB.DD,{"Type":"SingleUnlocked","Position":new NB(h.x+20,h.y)});}KB(i);h.AD=false;h.VF(false);var j=true;for(int g=0;g<VJ.length;g++ )j=j&&(VJ[g].AD==false);if(j){var l=eB.LB.iB("BonusAllUnlock");l.play();for(int g=0;g<VJ.length;g++ ){VJ[g].AD=true;p.fB(()=>VJ[(g+k)%VJ.length].VH(),g*0.2);}p.fB(()=>KB(new cB(cB.DD,{"Type":"All","Position":new NB(280,550)})),0.75);}} xJ(){var o=new rC();for(int i=0;i<10;i++ ){var k=9;var j=8;while (k>=0){while (k>=0&&UJ[i+k*10].empty==false){k-- ;j-- ;}while (j>=0&&UJ[i+j*10].empty==true){j-- ;}if(k>=0){var g,h,l;if(j>=0){h=UJ[i+j*10];if(i>0){l=UJ[i-1+j*10];if(h.WC(l)){l.dB=false;l.jB(ZJ,aJ,bJ);}}h.dB=false;h.empty=true;h.jB(ZJ,aJ,bJ);}else{if(TJ.length>0){h=TJ[0];TJ.removeRange(0,1);}else{h=new JB(SJ[PJ.nextInt(SJ.length)],PJ.nextInt(2));}}g=UJ[i+k*10];g.color=h.color;g.direction=h.direction;g.FB=h.FB;g.dB=false;g.empty=false;g.x=50*i+25;g.y=50*j+25;g.jB(ZJ,aJ,bJ);o.WD();var m=new LC(g.y,50*k+25,0.1,MB.MC);m.HC=(s){g.y=s;};m.onComplete=(){if(o.DF()==0){lJ();tJ();zJ();}};p.add(m);}}}} mJ( g){if(g.target==ZJ&&this.UB){var j=SB.min(g.IF/50,9).toInt();var h=SB.min(g.JF/50,9).toInt();var i=new NB(j,h);WJ.add(i);zJ();}} zJ(){while (QJ==xB.sC&&XJ==false&&WJ.length>0){var s=WJ[0];WJ.removeRange(0,1);var j=s.x.toInt();var k=s.y.toInt();var g=UJ[j+k*10];var h=(j>0)?UJ[j-1+k*10]:null;var o=(j<9)?UJ[j+1+k*10]:null;var i=(k>0)?UJ[j+(k-1)*10]:null;var m=(k<9)?UJ[j+(k+1)*10]:null;var l=false;if(g.FB==u.yB){var v=eB.LB.iB("ChainError");v.play();continue;}if(g.fC(i)){i.dB=false;i.jB(ZJ,aJ,bJ);}if(g.WC(h)){h.dB=false;h.jB(ZJ,aJ,bJ);}g.direction=1-g.direction;g.dB=false;g.GC=false;var EB=eB.LB.iB("ChainRotate");EB.play();if(g.WC(o)){g.dB=true;g.GC=(g.FB==u.OB||o.FB==u.OB);}if(g.fC(m)){g.dB=true;g.GC=(g.FB==u.OB||m.FB==u.OB);}g.jB(ZJ,aJ,bJ);l=l||g.dB;if(g.fC(i)){i.dB=true;i.GC=(g.FB==u.OB||i.FB==u.OB);i.jB(ZJ,aJ,bJ);l=true;}if(g.WC(h)){h.dB=true;h.GC=(g.FB==u.OB||h.FB==u.OB);h.jB(ZJ,aJ,bJ);l=true;}if(l){var IB=eB.LB.iB("ChainLink");IB.play();}tJ();}}}class cB extends CB{static const  PE="Explosion";static const  DD="Unlocked";static const  QE="Finalized";static const  gD="Timeouted";var zI;cB( h, g,[ bubbles=false]):super(h,bubbles){zI=g;} get info{return zI;}}class xB{static const  sC=1;static const  dD=2;static const  eD=3;}class OE extends AB{var JI;OE( j){var g=new JC();g.OC=new cE("Arial",30,0xFFFFFF,DC:true,align:qB.KC);g.width=110;g.height=36;g.wordWrap=false;g.x=646;g.y=130;g.UB=false;g.text=j.toString();g.x=-g.width/2;g.y=-g.height/2;JI=new AB();JI.n(g);n(JI);var i=new LC(0.0,1.0,1.5,MB.sB);i.HC=(h){JI.alpha=1-h;JI.y=-h*50;JI.vB=1.0+0.1*SB.sin(h*10);JI.EC=1.0+0.1*SB.cos(h*10);};i.onComplete=(){this.GE();};p.add(i);}}class iF extends AB{var KI;var TI;var eI;var UI;iF(){var m=new BB(GB.LB.q("ExitBox"));n(m);var g=new JC();g.OC=new cE("Arial",24,0xFFFFFF,DC:true,align:qB.KC);g.width=240;g.height=100;g.wordWrap=true;g.text=bC.LB.pC("GENexitquery");g.x=47;g.y=150-g.JE/2;g.UB=false;n(g);KI=new oD(7,GB.LB.q("ExitGauge"),JD.xD);KI.x=268;KI.y=25;KI.addEventListener("TimeOver",dJ);n(KI);KI.RD("TimeOver",0);KI.start();var i=new BB(GB.LB.q("ExitYesButtonNormal"));var j=new BB(GB.LB.q("ExitYesButtonPressed"));TI=new tC(i,i,j,j);TI.x=68;TI.y=239;TI.addEventListener(t.UC,hJ);n(TI);var h=new BB(GB.LB.q("ExitNoButtonNormal"));var k=new BB(GB.LB.q("ExitNoButtonPressed"));eI=new tC(h,h,k,k);eI.x=173;eI.y=232;eI.addEventListener(t.UC,jJ);n(eI);this.addEventListener(CB.uC,(l)=>p.add(KI));this.addEventListener(CB.wC,(l)=>p.remove(KI));} kJ( g){if(UI!=null){UI(g);UI=null;}} hJ( g){kJ(true);} jJ( g){kJ(false);} dJ( g){kJ(false);}show( g){UI=g;}}class cD{var yE;var YF;var ZF;var angle;var bF;var XB;}class JB{var FI;var GI;var QI;var WI;var bI;var dI;var kI;var oI;var rI;var vI;var yI;JB( h, g){FI=h;GI=g;QI=u.CD;WI=-1000;bI=-1000;dI=false;kI=false;oI=false;rI=null;vI=null;yI=null;} get color=>FI; set color( g){FI=g;} get direction=>GI; set direction( g){GI=g;} get FB=>QI; set FB( g){QI=g;} get dB=>dI; set dB( g){dI=g;} get GC=>kI; set GC( g){kI=g;} get empty=>oI; set empty( g){oI=g;} TD( g){var h=g!=null&&(g.color==FI||g.FB==u.OB||QI==u.OB)&&g.FB!=u.yB&&QI!=u.yB;return h;} WC( g){var h=g!=null&&(g.color==FI||g.FB==u.OB||QI==u.OB)&&g.direction==0&&GI==0&&g.FB!=u.yB&&QI!=u.yB;return h;} fC( g){var h=g!=null&&(g.color==FI||g.FB==u.OB||QI==u.OB)&&g.direction==1&&GI==1&&g.FB!=u.yB&&QI!=u.yB;return h;} get x=>WI; set x( g){WI=g;if(rI!=null)rI.x=g;if(vI!=null)vI.x=g;if(yI!=null)yI.x=g;} get y=>bI; set y( g){bI=g;if(rI!=null)rI.y=g;if(vI!=null)vI.y=g;if(yI!=null)yI.y=g;} set XF( h){if(rI!=null){var g=1+0.3*SB.sin(h*SB.PI);rI.vB=g;rI.EC=g;}} jB( g, h, i){if(rI!=null){rI.parent.uB(rI);rI=null;}if(vI!=null){vI.parent.uB(vI);vI=null;}if(yI!=null){yI.parent.uB(yI);yI=null;}if(empty==false){switch (QI){case u.OB:rI=new fH(GI);rI.x=WI;rI.y=bI;g.n(rI);break;case u.yB:rI=GB.hD(u.yB);rI.x=WI;rI.y=bI;g.n(rI);break;default:rI=GB.fD(FI,GI);rI.x=WI;rI.y=bI;g.n(rI);break;}if(dI){vI=kI?new eH(GI):GB.jF(FI,GI);vI.x=WI+((GI==0)?25:0);vI.y=bI+((GI==1)?25:0);h.n(vI);}switch (QI){case u.CD:break;case u.yB:break;case u.OB:break;default:yI=new dH(QI);yI.x=WI;yI.y=bI;i.n(yI);break;}}}}class gF extends AB{var II;var SI;var cI;var lI;var KI;var pI;var sI;var uI;var xI;var HI;var BJ;var CJ;var DJ;var EJ;var GJ;var HJ;var IJ;var KJ;var LJ;gF(){var j=new BB(GB.LB.q("ShuffleButtonNormal"));var h=new BB(GB.LB.q("ShuffleButtonPressed"));SI=new tC(j,j,h,h);SI.addEventListener(t.UC,YJ);SI.x=530;SI.y=525;n(SI);var g=new BB(GB.LB.q("ExitButtonNormal"));var i=new BB(GB.LB.q("ExitButtonPressed"));cI=new tC(g,g,i,i);cI.addEventListener(t.UC,gJ);cI.x=700;cI.y=500;n(cI);II=new eF();II.x=540;II.y=-1000;n(II);KI=new oD(10,GB.LB.q("TimeGauge"),JD.rD);KI.x=659;KI.y=244;KI.addEventListener("TimeShort",iJ);KI.addEventListener("TimeOver",dJ);n(KI);p.add(KI);pI=new hF();pI.x=640;pI.y=230;n(pI);sI=new dF();sI.x=665;sI.y=160;n(sI);uI=new JC();uI.OC=new cE("Arial",30,0xD0D0D0,DC:true,align:qB.KC);uI.width=140;uI.height=36;uI.wordWrap=false;uI.x=646;uI.y=130;uI.UB=false;uI.text="0";uI.vB=0.9;n(uI);xI=new JC();xI.OC=new cE("Arial",20,0xFFFFFF,DC:true,align:qB.KC);xI.width=44;xI.height=30;xI.wordWrap=false;xI.x=610;xI.y=559;xI.UB=false;xI.text="3x";n(xI);GJ=new AB();n(GJ);HJ=new AB();n(HJ);IJ=new AB();n(IJ);KJ=eB.LB.iB("Intro");LJ=KJ.play();} start(){HI=1;BJ=1;EJ=0;CJ=3;var g=new bD(bC.LB.pC("ESCStartText"));HJ.n(g);p.fB(()=>pI.OF(21),1);g.show(()=>p.fB(()=>nJ(),0.5));} nJ(){if(lI!=null&&this.contains(lI))GJ.uB(lI);var m=HI;var g=0;var h=0;switch (HI){case 01:h=50;lI=new fF(g=40,3,0,0,0,0,[0,1,2]);break;case 02:h=45;lI=new fF(g=45,3,1,0,0,0,[2,3,4]);break;case 03:h=40;lI=new fF(g=50,4,2,2,1,0,[5,6,7]);break;case 04:h=35;lI=new fF(g=55,4,3,3,2,0,[0,2,6]);break;case 05:h=30;lI=new fF(g=60,5,4,4,2,1,[1,3,5]);break;case 06:h=34;lI=new fF(g=60,5,5,5,3,2,[1,2,4,7]);break;case 07:h=33;lI=new fF(g=65,5,5,6,3,2,[0,1,2,3]);break;case 08:h=32;lI=new fF(g=70,5,5,6,3,2,[0,2,5,6]);break;case 09:h=31;lI=new fF(g=75,5,5,6,3,2,[1,4,5,7]);break;default:h=30;lI=new fF(g=80+(HI-10)*5,5,5,6,3,2,[0,1,2,3]);break;}DJ=g;if(CJ<3){CJ++ ;xI.text="${CJ}x";}lI.addEventListener(cB.PE,oJ);lI.addEventListener(cB.DD,pJ);lI.addEventListener(cB.QE,qJ);lI.addEventListener(cB.gD,rJ);lI.x=20;lI.y=16;lI.UB=false;GJ.n(lI);KI.reset(h);KI.RD("TimeShort",9);KI.RD("TimeOver",0);KI.pause();II.level=m;II.zE=g;II.y=-210;var k=new mB(II,0.4,MB.sB);k.WB("y",-90);p.add(k);var j=new bD(bC.LB.pC("ESCLevelBoxText").replaceAll("{0}","${g}"));HJ.n(j);j.show((){lI.UB=true;KI.start();if(KJ!=null){var i=new LC(1.0,0.0,4.0,MB.MC);i.HC=(l){LJ.FC.volume=l;LJ.FC=LJ.FC;};i.onComplete=(){LJ.stop();pI.JH();};p.add(i);KJ=null;}});} iJ( g){sI.start();} dJ( g){lI.aF(xB.eD);} pJ( j){var g=0;var k=j.info["Position"];var h=j.info["Type"];if(h=="SingleLocked")g=3000;if(h=="SingleUnlocked")g=1000;if(h=="All")g=10000;var i=new OE(g);i.x=k.x;i.y=k.y;GJ.n(i);EJ=EJ+g;uI.text="${EJ}";} oJ( j){var g=DJ;var i=j.info["Length"];var k=j.info["Factor"];g=(g>i)?g-i:0;DJ=g;II.zE=g;if(g==0)lI.aF(xB.dD);var h=0;switch (i){case 3:h=1000;break;case 4:h=2000;break;case 5:h=5000;break;default:h=5000;break;}EJ=EJ+h*k;uI.text="${EJ}";} qJ( m){KI.pause();sI.stop();var l=eB.LB.iB("Laugh");var k=eB.LB.iB("LevelUp");l.play();pI.OF(3);var g=GB.kF();g.x=55;g.y=260;GJ.n(g);p.fB((){lI.FF();k.play();},2.0);p.fB((){var j=(KI.SH*1000).toInt();var h=new OE(j);h.x=704;h.y=360;GJ.n(h);EJ=EJ+j;uI.text="${EJ}";},2.5);var i=new mB(II,0.5,MB.sB);i.WB("y",-210);i.delay=3.0;p.add(i);p.fB((){GJ.uB(g);},3.5);p.fB((){HI++ ;nJ();},4.0);} rJ( j){sI.stop();lI.FF();var g;var i;if(BJ>0){BJ-- ;g=new bD(bC.LB.pC("GEN2ndchancetime"));HJ.n(g);i=eB.LB.iB("LevelUp");i.play();g.show((){p.fB(()=>nJ(),0.5);var h=new mB(II,0.5,MB.sB);h.WB("y",-210);p.add(h);});}else{g=new bD(bC.LB.pC("GENtimeup"));HJ.n(g);i=eB.LB.iB("GameOver");i.play();g.show((){p.fB(()=>uJ(),0.5);var h=new mB(II,0.5,MB.sB);h.WB("y",-210);p.add(h);});}} YJ( h){if(lI!=null&&CJ>0){var g=lI.WF();if(g){CJ=CJ-1;xI.text="${CJ}x";}}} gJ( j){var h=new AB();h.n(new BB(new DB(800,600,false,0x000000)));h.alpha=0.6;IJ.n(h);var g=new iF();g.x=235;g.y=150;IJ.n(g);g.show(( i){IJ.uB(g);if(i==false)IJ.uB(h);else wJ(false);});}uJ(){var h=new AB();var j=new BB(GB.LB.q("ExitBox"));h.n(j);var g=new JC();g.OC=new cE("Arial",30,0xFFFFFF,DC:true,align:qB.KC);g.width=240;g.height=200;g.wordWrap=true;g.text=bC.LB.pC("GENgameover");g.x=47;g.y=30+(g.height-g.JE)/2;g.UB=false;h.n(g);h.x=110;h.y=-h.height;HJ.n(h);var k=eB.LB.iB("Laugh");p.fB(()=>k.play(),0.3);var i=new mB(h,0.3,MB.sB);i.WB("y",150);p.add(i);p.fB(()=>wJ(true),5.0);h.addEventListener(t.UC,( l)=>wJ(true));}var yJ=false; wJ( g){KI.pause();if(yJ==false){yJ=true;}}}class BD extends AB{var FI;var OI;var ZI;var jI;BD( g){FI=g;ZI=GB.oF(g);jI=true;OI=new BB(ZI[0]);OI.x=-34;OI.y=-50;n(OI);} get AD=>jI; set AD( g){jI=g;} VF( g){OI.PB=ZI[g?0:4];} VH(){var i=new LC(0.0,1.0,2.0,MB.sB);i.HC=(j){vB=EC=1.0+0.2*SB.sin(j*4*SB.PI);};var g=new mB(this,0.2,MB.sB);g.WB("alpha",0.0);g.delay=2.0;g.onComplete=()=>VF(jI);var h=new mB(this,0.2,MB.vE);h.WB("alpha",1);h.delay=2.2;p.add(i);p.add(g);p.add(h);}}class eF extends AB{var HI;var RI;var YI;var gI;var mI;eF(){n(new BB(GB.LB.q("InfoBox")));RI=new JC();RI.OC=new cE("Arial",35,0xFFFFFF,DC:true,align:qB.KC);RI.width=220;RI.height=40;RI.wordWrap=false;RI.text="Level 1";RI.x=20;RI.y=115;RI.XB=-2*SB.PI/180;n(RI);gI=new JC();gI.OC=new cE("Arial",25,0xFFFFFF,DC:true,align:qB.KC);gI.width=220;gI.height=30;gI.wordWrap=false;gI.text="40";gI.x=-gI.width/2;gI.y=-gI.height/2;gI.XB=-2*SB.PI/180;mI=new AB();mI.n(gI);mI.x=150;mI.y=172;n(mI);var g=GB.fD(3,0);g.x=110;g.y=171;g.XB=-2*SB.PI/180;g.vB=g.EC=0.6;n(g);} set level( g){HI=g;RI.text="Level ${HI}";} set zE( g){YI=g;gI.text="${YI}";}}class dH extends AB implements kB{var OI;var aI;dH( h){this.UB=false;aI=0.0;OI=GB.hD(h);n(OI);addEventListener(CB.uC,(g)=>p.add(this));addEventListener(CB.wC,(g)=>p.remove(this));} CC( g){aI+= g;this.XB=SB.sin(aI*7)*10*SB.PI/180;return true;}}class bD extends AB{var MI;var UI;bD( h){var i=new BB(GB.LB.q("MessageBox"));n(i);var g=new JC();g.OC=new cE("Arial",24,0xFFFFFF,DC:true,align:qB.KC);g.width=240;g.height=200;g.wordWrap=true;g.text=h;g.x=47;g.y=130-g.JE/2;g.UB=false;n(g);MI=null;addEventListener(t.UC,RJ);}void show( h){this.parent.n(this);this.x=-this.width;this.y=150;UI=h;var g=new mB(this,0.3,MB.sB);g.WB("x",110);g.onComplete=()=>MI=p.fB(fJ,10);p.add(g);} fJ(){if(MI!=null){p.remove(MI);MI=null;UI();var g=new mB(this,0.4,MB.vE);g.WB("x",800);g.onComplete=()=>this.parent.uB(this);p.add(g);}} RJ( g){fJ();}}class rC{var value=0; WD([ inc=1])=>(value+= inc); DF([ dec=1])=>(value-= dec);}class fH extends AB implements kB{var OI;var fI;var aI;fH( g){this.UB=false;aI=0.0;fI=GB.mF(g);OI=new BB(fI[0]);OI.x=-25;OI.y=-25;n(OI);addEventListener(CB.uC,(h)=>p.add(this));addEventListener(CB.wC,(h)=>p.remove(this));} CC( g){aI+= g;var h=(aI*10).toInt()%fI.length;OI.PB=fI[h];return true;}}class hF extends AB{var LI;var VI;var iI;hF(){LI=GB.pF();VI=new BB(LI[0]);VI.x=-VI.width/2;VI.y=-VI.height/2;n(VI);iI=null;} OF( g){p.remove(iI);iI=new LC(0,g,0.5*g,MB.MC);iI.HC=(h){var i=((h*LI.length)%LI.length).toInt();VI.PB=LI[i];VI.y=SB.sin(h*2*SB.PI)*3-VI.height/2;};p.add(iI);} JH(){p.remove(iI);VI.PB=LI[0];}}class eH extends AB implements kB{var OI;var fI;var aI;eH( g){this.UB=false;aI=0.0;fI=GB.nF(g);OI=new BB(fI[0]);OI.x=-25;OI.y=-25;n(OI);addEventListener(CB.uC,(h)=>p.add(this));addEventListener(CB.wC,(h)=>p.remove(this));} CC( g){aI+= g;var h=(aI*10).toInt()%fI.length;OI.PB=fI[h];return true;}}class GB{static var LB;static  fD( i, h){var g=new BB(LB.PC("Elements").q("Chain${i}${h}"));g.RC=25;g.SC=25;return g;}static  jF( i, h){var g=new BB(LB.PC("Elements").q("Link${i}${h}"));g.RC=25;g.SC=25;return g;}static  hD( h){var g=new BB(LB.PC("Elements").q(h));g.RC=25;g.SC=25;return g;}static  kF(){var m=new AB();var l=0;var o=LB.PC("Levelup");for(int k=0;k<7;k++ ){var g=new BB(o.q("LevelUp${k}"));g.x=-g.width/2;g.y=-g.height/2;var h=new AB();h.n(g);h.x=l+g.width/2;h.vB=0;h.EC=0;m.n(h);var i=new mB(h,2.0,MB.pG);i.WB("scaleX",1.0);i.WB("scaleY",1.0);i.delay=k*0.05;var j=new mB(h,0.4,MB.MC);j.WB("scaleX",0.0);j.WB("scaleY",0.0);j.delay=3.0;p.add(i);p.add(j);l=l+5+g.width;}return m;}static  mF( h){var i=LB.PC("Elements");var g=new List<DB>();g.add(i.q("JokerChain${h}0"));g.add(i.q("JokerChain${h}1"));g.add(i.q("JokerChain${h}2"));g.add(i.q("JokerChain${h}3"));g.add(i.q("JokerChain${h}4"));return g;}static  nF( h){var i=LB.PC("Elements");var g=new List<DB>();g.add(i.q("JokerLink${h}0"));g.add(i.q("JokerLink${h}1"));g.add(i.q("JokerLink${h}2"));g.add(i.q("JokerLink${h}3"));g.add(i.q("JokerLink${h}4"));return g;}static  oF( h){var i=LB.PC("Locks");var g=new List<DB>();g.add(i.q("Lock${h}0"));g.add(i.q("Lock${h}1"));g.add(i.q("Lock${h}2"));g.add(i.q("Lock${h}3"));g.add(i.q("Lock${h}4"));return g;}static  pF(){var h=LB.PC("Head");var g=new List<DB>();g.add(h.q("Head1"));g.add(h.q("Head2"));g.add(h.q("Head3"));g.add(h.q("Head2"));g.add(h.q("Head1"));return g;}static  qF(){var h=LB.PC("Alarm");var g=new List<DB>();g.add(h.q("Alarm0"));g.add(h.q("Alarm1"));g.add(h.q("Alarm2"));g.add(h.q("Alarm3"));g.add(h.q("Alarm4"));g.add(h.q("Alarm5"));return g;}}class PE extends AB implements kB{var wI;var aI;PE( s, o){wI=new List<cD>();aI=0.0;this.UB=false;var v=GB.fD(s,o);var m=new SB.Random();var i;var l;var EB;for(int h=0;h<=1;h++ ){for(int g=0;g<=1;g++ ){if(g==0&&h==0){i=SB.PI*1.15;XB=-SB.PI*2;}if(g==1&&h==0){i=SB.PI*1.85;XB=SB.PI*2;}if(g==1&&h==1){i=SB.PI*0.15;XB=SB.PI*2;}if(g==0&&h==1){i=SB.PI*0.85;XB=-SB.PI*2;}i=i+0.2*SB.PI*m.nextDouble();l=80.0+40.0*m.nextDouble();var j=new BB(v.PB);j.SD=new QB(g*25,h*25,25,25);j.RC=12.5+g*25;j.SC=12.5+h*25;j.x=g*25;j.y=h*25;n(j);var k=new cD();k.yE=j;k.YF=g*25+12.5;k.ZF=h*25+12.5;k.angle=i;k.bF=l;k.XB=XB;wI.add(k);}}} CC( m){aI=SB.min(0.8,aI+m);var v=981.0;for(int h=0;h<wI.length;h++ ){var g=wI[h];var i=g.yE;var j=g.angle;var k=g.bF;var l=g.XB;var o=g.YF+aI*(SB.cos(j)*k);var s=g.ZF+aI*(SB.sin(j)*k+aI*v*0.5);i.x=o;i.y=s;i.XB=aI*l;}if(aI>=0.6)this.alpha=(0.8-aI)/0.2;if(aI>=0.8)this.GE();return (aI<0.8);}}var ED;var cC;var FD;var p;var TC;var GD;var zB; main(){ED=new oC("StageBackground",aC.query('#stageBackground'));cC=new oC("StageForeground",aC.query('#stageForeground'));FD=new vF();FD.xE(ED);FD.xE(cC);p=FD.GH;var g=DB.wE("images/Loading.png");g.then((h){TC=new BB(h);TC.RC=20;TC.SC=20;TC.x=400;TC.y=270;cC.n(TC);GD=new mB(TC,100,MB.MC);GD.WB("rotation",100.0*2.0*SB.PI);p.add(GD);zB=new JC();zB.OC=new cE("Arial",20,0xA0A0A0,DC:true);zB.width=240;zB.height=40;zB.text="... loading ...";zB.x=400-zB.XH/2;zB.y=320;zB.UB=false;cC.n(zB);lF();});} lF(){var g=new hC();g.hB("Background","images/Background.jpg");g.hB("ExitBox","images/ExitBox.png");g.hB("ExitButtonNormal","images/ExitButtonNormal.png");g.hB("ExitButtonPressed","images/ExitButtonPressed.png");g.hB("ExitGauge","images/ExitGauge.png");g.hB("ExitNoButtonNormal","images/ExitNoButtonNormal.png");g.hB("ExitNoButtonPressed","images/ExitNoButtonPressed.png");g.hB("ExitYesButtonNormal","images/ExitYesButtonNormal.png");g.hB("ExitYesButtonPressed","images/ExitYesButtonPressed.png");g.hB("InfoBox","images/InfoBox.png");g.hB("MessageBox","images/MessageBox.png");g.hB("ShuffleButtonNormal","images/ShuffleButtonNormal.png");g.hB("ShuffleButtonPressed","images/ShuffleButtonPressed.png");g.hB("TimeGauge","images/TimeGauge.png");g.yC("Alarm","images/AlarmTextureAtlas.json",dC.nC);g.yC("Head","images/HeadTextureAtlas.json",dC.nC);g.yC("Elements","images/ElementsTextureAtlas.json",dC.nC);g.yC("Levelup","images/LevelupTextureAtlas.json",dC.nC);g.yC("Locks","images/LocksTextureAtlas.json",dC.nC);g.bB("BonusAllUnlock","sounds/BonusAllUnlock.mp3");g.bB("BonusUniversal","sounds/BonusUniversal.mp3");g.bB("ChainBlast","sounds/ChainBlast.mp3");g.bB("ChainBlastSpecial","sounds/ChainBlastSpecial.mp3");g.bB("ChainError","sounds/ChainError.mp3");g.bB("ChainFall","sounds/ChainFall.mp3");g.bB("ChainHelp","sounds/ChainHelp.mp3");g.bB("ChainLink","sounds/ChainLink.mp3");g.bB("ChainRotate","sounds/ChainRotate.mp3");g.bB("Click","sounds/Click.mp3");g.bB("GameOver","sounds/GameOver.mp3");g.bB("Laugh","sounds/Laugh.mp3");g.bB("LevelUp","sounds/LevelUp.mp3");g.bB("PointsCounter","sounds/PointsCounter.mp3");g.bB("Unlock","sounds/Unlock.mp3");g.bB("Warning","sounds/Warning.mp3");g.bB("Intro","sounds/Intro.mp3");g.nB("ESCAPE_INS_AIM_0","Connect at least 3 chain links of the same colour to a horizontal or vertical chain.");g.nB("ESCAPE_INS_DES_0","You can change the direction of a chain link by touching it.");g.nB("ESCAPE_INS_TIP_0","Earn extra points for connecting chain links displaying a key symbol.");g.nB("ESCBlockErrorHint","Sorry but block chains can´t be twisted!");g.nB("ESCLevelBoxText","Connect {0} chain links and help the crook to escape!");g.nB("ESCNoActionHint","Press on the chain links to twist them.");g.nB("ESCNoComboHint","You have to connect at least 3 chain links of the same colour.");g.nB("ESCStartText","Form horizontal or vertical same-colour chains and become an escape agent!");g.nB("ESCtogo","Chain links:");g.nB("GENexitquery","Do you really want to quit the game?");g.nB("GEN2ndchancetime","Time is up. Second chance!");g.nB("GENtimeup","Sorry! Your time is up.");g.nB("GENgameover","Game Over");g.load().then((j){cC.uB(TC);cC.uB(zB);p.remove(GD);GB.LB=g;eB.LB=g;bC.LB=g;var i=new BB(GB.LB.q("Background"));ED.n(i);ED.RH=lC.vD;var h=new gF();cC.n(h);h.start();});}abstract class lB extends w{var tG=false;var UB=true;var yH=true;var tabIndex=0;WE get on=>new WE(this);}class jD extends HB{var UK;var nK;var GL;jD(){GL=new List<ID>();UK=new aC.AudioElement();UK.on.ended.add(nL);nK=new List<aC.AudioElement>();nK.add(UK);aC.document.body.children.add(UK);}static  DG( l){var g=new jD();var j=new Completer<HB>();var i;var h;i=(k){g.UK.on.canPlayThrough.remove(i);g.UK.on.error.remove(h);j.complete(g);};h=(k){g.UK.on.canPlayThrough.remove(i);g.UK.on.error.remove(h);j.completeException("Failed to load audio.");};g.UK.src=HB.tE(l);g.UK.on.canPlayThrough.add(i);g.UK.on.error.add(h);g.UK.load();return j.future;} get length{return UK.duration;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new VB();return new ID(this,loop,soundTransform);} GM( h){var g;if(nK.length==0){g=UK.clone(true);g.on.ended.add(nL);}else{g=nK.removeAt(0);}GL.add(h);return g;} ON( g){var h=g.UK;var i=GL.indexOf(g);GL.removeAt(i);nK.add(h);if(UK.currentTime>0&&UK.ended==false)UK.currentTime=0;} nL(j){var i=j.target;var g=null;for(int h=0;h<GL.length&&g==null;h++ )if(GL[h].UK==i)g=GL[h];if(g!=null)g.stop();}}abstract class w extends ZB implements aE{var pK=0.0;var vK=0.0;var DL=0.0;var IL=0.0;var OL=1.0;var UL=1.0;var ZL=0.0;var hL;var jL;var qL=1.0;var sL=true;var GK="";var EM=null;var mask;var bM;var eM;w(){hL=new YB.CI();jL=true;bM=new YB.CI();eM=new YB.CI();} get x=>pK; get y=>vK; get RC=>DL; get SC=>IL; get vB=>OL; get EC=>UL; get XB=>ZL; get alpha=>qL; get visible=>sL; get name=>GK; get parent=>EM;UE get on=>new UE(this); get root{var g=this;while (g.EM!=null)g=g.EM;return g;} get YD{var g=this.root;if(g is oC)return g;return null;} set x( g){pK=g;jL=true;} set y( g){vK=g;jL=true;} set RC( g){DL=g;jL=true;} set SC( g){IL=g;jL=true;} set vB( g){OL=g;jL=true;} set EC( g){UL=g;jL=true;} set XB( g){ZL=g;jL=true;} set alpha( g){qL=g;jL=true;} get width=>tB(AN).width; get height=>tB(AN).height; set width( h){this.vB=1;var g=this.width;this.vB=(g!=0.0)?h/g:1.0;} set height( h){this.EC=1;var g=this.height;this.EC=(g!=0.0)?h/g:1.0;} GE(){if(EM!=null)EM.uB(this);} get AN{if(jL){jL=false;if(ZL==0.0){hL.UF(OL,0.0,0.0,UL,pK-DL*OL,vK-IL*UL);}else{var g=SB.cos(ZL);var h=SB.sin(ZL);var i=OL*g;var l=OL*h;var k=-UL*h;var j=UL*g;var m=pK-DL*i-IL*k;var o=vK-DL*l-IL*j;hL.UF(i,l,k,j,m,o);}}return hL;} tB( g,[ returnRectangle]){if(returnRectangle==null)returnRectangle=new QB.zH();returnRectangle.x=g.XC;returnRectangle.y=g.YC;returnRectangle.width=0;returnRectangle.height=0;return returnRectangle;} QC( g, h){if(tB(eM).contains(g,h))return this;return null;} qC( h){bM.zG();for(w g=this;g!=null;g=g.EM)bM.concat(g.AN);bM.FH();return bM.ZH(h);} KB( h){var g=null;if(h.CE||h.bubbles)for(w j=EM;j!=null;j=j.EM)if(j.yG(h.type)){if(g==null)g=new List<w>();g.add(j);}if(h.CE&&g!=null)for(int i=g.length-1;i>=0;i-- )if(h.HE==false)g[i].lM(h,this,g[i],eC.eE);if(h.HE==false)lM(h,this,this,eC.LD);if(h.bubbles&&g!=null)for(int i=0;i<g.length;i++ )if(h.HE==false)g[i].lM(h,this,g[i],eC.QG);} XN( h){for(var g=h;g!=null;g=g.EM)if(g==this)throw new ArgumentError("Error #2150: An object cannot be added as a child to one of it's children (or children's children, etc.).");EM=h;} oB( g);}class bE{static const  NG="none";static const  TG="touchPoint";}abstract class jC extends lB{var qK;var wK=true;var HL=true;jC(){qK=new List<w>();}tF get on=>new tF(this); n( g){if(g.parent==this){var h=qK.indexOf(g);qK.removeAt(h);qK.add(g);}else{qG(g,qK.length);}} qG( g, h){if(h<0&&h>qK.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");if(g==this)throw new ArgumentError("Error #2024: An object cannot be added as a child of itself.");if(g.parent==this){qK.removeAt(qK.indexOf(g));if(h>qK.length)h-- ;qK.insertRange(h,1,g);}else{g.GE();g.XN(this);qK.insertRange(h,1,g);g.KB(new CB(CB.FG,true));if(this.YD!=null)YN(g,new CB(CB.uC));}} uB( h){var g=qK.indexOf(h);if(g==-1)throw new ArgumentError("Error #2025: The supplied DisplayObject must be a child of the caller.");QH(g);} QH( g){if(g<0&&g>=qK.length)throw new ArgumentError("Error #2006: The supplied index is out of bounds.");var h=qK[g];h.KB(new CB(CB.XG,true));if(this.YD!=null)YN(h,new CB(CB.wC));h.XN(null);qK.removeAt(g);} contains( g){for(;g!=null;g=g.EM)if(g==this)return true;return false;} tB( m,[ returnRectangle]){if(returnRectangle==null)returnRectangle=new QB.zH();if(qK.length==0)return super.tB(m,returnRectangle);var h=double.INFINITY;var i=double.INFINITY;var l=double.NEGATIVE_INFINITY;var k=double.NEGATIVE_INFINITY;var o=qK.length;for(int j=0;j<o;j++ ){bM.EE(qK[j].AN,m);var g=qK[j].tB(bM,returnRectangle);if(g.left<h)h=g.left;if(g.top<i)i=g.top;if(g.right>l)l=g.right;if(g.bottom>k)k=g.bottom;}returnRectangle.x=h;returnRectangle.y=i;returnRectangle.width=l-h;returnRectangle.height=k-i;return returnRectangle;} QC( s, v){var l=null;for(int j=qK.length-1;j>=0;j-- ){var i=qK[j];if(i.visible){var g=i.AN;var m=s-g.XC;var k=v-g.YC;var EB=(g.d*m-g.c*k)/g.gC;var o=(g.a*k-g.b*m)/g.gC;var h=i.QC(EB,o);if(h!=null){if(h is lB)if(h.UB)return wK?h:this;l=this;}}}return l;} oB( i){for(int g=0;g<qK.length;g++ ){var h=qK[g];if(h.visible)i.TF(h);}} YN( g, j){g.KB(j);if(g is jC){var i=new List<w>.from(g.qK);var k=i.length;for(int h=0;h<k;h++ )YN(i[h],j);}}}class iD implements kB{var OK=0.0;var gK=0.0;var sK=1;var EL;iD( g, h){EL=g;gK=SB.max(h,0.0001);} CC( h){var g=OK+h;while (g>=gK&&sK>0){OK=gK;sK-- ;EL();g-= gK;}if(sK==0)return false;OK=g;return true;} get totalTime=>gK; get currentTime=>OK;}class NB{var x;var y;NB(this.x,this.y);NB.zH():this(0,0); get length=>SB.sqrt(this.x*this.x+this.y*this.y); add( g)=>new NB(this.x+g.x,this.y+g.y); equals( g)=>this.x==g.x&&this.y==g.y;}class QB{var x;var y;var width;var height;QB(this.x,this.y,this.width,this.height);QB.zH():this(0,0,0,0); get left=>this.x; get top=>this.y; get right=>this.x+this.width; get bottom=>this.y+this.height; get size=>new NB(this.width,this.height); set bottom( g){this.height=g-this.y;} set left( g){this.x=g;} set right( g){this.width=g-this.x;} set top( g){this.y=g;} contains( g, h)=>(this.x<=g&&this.y<=h&&this.right>=g&&this.bottom>=h); equals( g)=>(this.x==g.x&&this.y==g.y&&this.width==g.width&&this.height==g.height); get isEmpty=>(this.width==0&&this.height==0);}class AB extends jC{var lH=false;var LE=false;}class xF{xF();}class YB{var BK,CK,DK,FK,IK,KK;var PK;YB.CI():BK=1.0,CK=0.0,DK=0.0,FK=1.0,IK=0.0,KK=0.0,PK=1.0; get a=>BK; get b=>CK; get c=>DK; get d=>FK; get XC=>IK; get YC=>KK; get gC=>PK; ZH( g){return new NB(g.x*BK+g.y*DK+IK,g.x*CK+g.y*FK+KK);} concat( g){var m=BK;var v=CK;var EB=DK;var s=FK;var l=IK;var o=KK;var RB=PK;var j=g.a;var k=g.b;var i=g.c;var h=g.d;var gB=g.XC;var IB=g.YC;var pB=g.gC;BK=(m*j+v*i);CK=(m*k+v*h);DK=(EB*j+s*i);FK=(EB*k+s*h);IK=(l*j+o*i+gB);KK=(l*k+o*h+IB);PK=(RB*pB);} zG(){BK=1.0;CK=0.0;DK=0.0;FK=1.0;IK=0.0;KK=0.0;PK=1.0;} FH(){var j=BK;var m=CK;var l=DK;var k=FK;var h=IK;var i=KK;var g=PK;BK=(k/g);CK=-(m/g);DK=-(l/g);FK=(j/g);IK=-(BK*h+DK*i);KK=-(CK*h+FK*i);PK=(1.0/g);} UF( g, j, i, h, k, l){BK=g;CK=j;DK=i;FK=h;IK=k;KK=l;PK=(g*h-j*i);} EE( h, g){var o=h.a;var EB=h.b;var IB=h.c;var v=h.d;var m=h.XC;var s=h.YC;var gB=h.gC;var k=g.a;var l=g.b;var j=g.c;var i=g.d;var pB=g.XC;var RB=g.YC;var ZC=g.gC;BK=(o*k+EB*j);CK=(o*l+EB*i);DK=(IB*k+v*j);FK=(IB*l+v*i);IK=(m*k+s*j+pB);KK=(m*l+s*i+RB);PK=(gB*ZC);}}abstract class aE{ oB( g);}class BB extends w{var PB;var OH;var SD;BB([this.PB=null,this.OH="auto"]){SD=null;} tB( h,[ returnRectangle]){var g=(PB!=null)?PB.width:0;var i=(PB!=null)?PB.height:0;return BE(h,g,i,returnRectangle);} QC( g, h){if(PB!=null&&g>=0.0&&h>=0.0&&g<PB.width&&h<PB.height)return this;return null;} oB( g){if(PB!=null){if(SD==null)PB.oB(g);else PB.SF(g,SD);}}}class vF{var EK;var RK;var aK;var yK;var JL;vF(){EK=new mD();RK=new List<oC>();aK=double.NAN;yK=KD.qD;JL=new sF(0);aC.window.requestAnimationFrame(JM);} get GH=>EK; JM( g){aC.window.requestAnimationFrame(JM);if(aK.isNaN)aK=g;if(aK>g)aK=g;var j=g-aK;var i=j/1000.0;if(j>=1){aK=g;JL.MK=i;yK.KB(JL);EK.CC(i);for(int h=0;h<RK.length;h++ ){var k=RK[h];k.IH();}}} xE( g){RK.add(g);}}class AC{var NK;var fK;var tK;var CL;AC.BI( h){NK=h;fK=new List<YB>(100);tK=new List<double>(100);CL=0;for(int g=0;g<100;g++ ){fK[g]=new YB.CI();tK[g]=1.0;}} get context=>NK; reset(){NK.setTransform(1.0,0.0,0.0,1.0,0.0,0.0);NK.globalAlpha=1;NK.clearRect(0,0,NK.canvas.width,NK.canvas.height);CL=0;} TF( h){var i=CL;var j=CL+1;var l=fK[i];var g=fK[j];var m=tK[i];var k=tK[j]=h.qL*m;g.EE(h.AN,l);NK.setTransform(g.a,g.b,g.c,g.d,g.XC,g.YC);NK.globalAlpha=k;CL=j;if(h.mask==null){h.oB(this);}else{NK.save();h.mask.oB(this);h.oB(this);NK.restore();}CL=i;}}class lC{static const  pD="auto";static const  KG="stop";static const  vD="once";}class CB{static const  FG="added";static const  uC="addedToStage";static const  wD="enterFrame";static const  XG="removed";static const  wC="removedFromStage";var AK;var vM;var xM;var CN;var DN;var GN;var IN;CB( g,[ bubbles=false]){dM(g,bubbles);} dM( g,[ bubbles=false]){AK=g;vM=bubbles;xM=eC.LD;CN=null;DN=null;GN=false;IN=false;} get HE=>GN; get WH=>IN; get type=>AK; get eventPhase=>xM; get bubbles=>vM; get CE=>true; get target=>CN;}class TE{var SG;TE( g){SG=g;} operator[]( g){return SG.eL(g);}}class eC{static const  eE=1;static const  LD=2;static const  QG=3;}class ZB{var XK; yG( g){return XK!=null&&XK.containsKey(g);} addEventListener( g, h,[ useCapture=false]){eL(g).add(h,useCapture);} KB( g){lM(g,this,this,eC.LD);}TE get on=>new TE(this); lM( g, i, k, j){if(XK!=null){var h=XK[g.type];if(h!=null){g.CN=i;g.DN=k;g.xM=j;g.GN=false;g.IN=false;h.KB(g);}}} eL( h){if(XK==null)XK=new Map<String,TB>();var g=XK[h];if(g==null)g=XK[h]=new TB(this,h);return g;}}class dC{static const  EG="json";static const  nC="jsonarray";}class zF{var UD;var aD;zF(this.UD,this.aD);}class rF{var AK;var JK;var ZK;var mK;rF.AI( i, g, h, j){AK=0;JK=new QB(i,g,h,j);} oB( i){var g=i.context;g.beginPath();switch (AK){case 0:g.rect(JK.x,JK.y,JK.width,JK.height);break;case 1:g.arc(ZK.x,ZK.y,ZK.uH,0,SB.PI*2.0,false);break;case 2:g.moveTo(mK[0].x,mK[0].y);for(int h=1;h<mK.length;h++ )g.lineTo(mK[h].x,mK[h].y);break;}g.clip();}}class UE extends TE{UE( g):super(g);}abstract class kB{ CC( g);}class tC extends lB{var KE;var QF;var EF;var VD;var LE=true;var enabled=true;var fL;tC([this.KE,this.QF,this.EF,this.VD]){addEventListener(t.pE,BM);addEventListener(t.OD,BM);addEventListener(t.MD,BM);addEventListener(t.yD,BM);fL=this.KE;} tB( g,[ returnRectangle]){if(fL!=null){bM.EE(fL.AN,g);return fL.tB(bM,returnRectangle);}return super.tB(g,returnRectangle);} QC( k, l){if(this.VD!=null){var g=this.VD.AN;var h=k-g.XC;var i=l-g.YC;var m=(g.d*h-g.c*i)/g.gC;var j=(g.a*i-g.b*h)/g.gC;if(this.VD.QC(m,j)!=null)return this;}return null;} oB( g){if(fL!=null)g.TF(fL);} BM( g){if(g.type==t.OD){fL=KE;}else{fL=g.NC?EF:QF;}}}class YE{var target=null;var NC=false;var DE=0;var zC=0;var MF,NF;var KF,LF;YE(this.MF,this.NF,this.KF,this.LF);}class KD{static final qD=new KD();var cL;KD(){cL=new List<TB>();} add( g){cL.add(g);} remove( h){var g=cL.indexOf(h);if(g!=-1)cL[g]=null;} KB( j){var k=cL.length;var h=0;for(int g=0;g<k;g++ ){var i=cL[g];if(i!=null){j.CN=i.GF;j.DN=i.GF;j.xM=eC.LD;i.KB(j);if(h!=g)cL[h]=i;h++ ;}}for(int g=k;g<cL.length;g++ )cL[h++ ]=cL[g];cL.length=h;}}class WE extends UE{WE( g):super(g); get mouseOut=>this[t.OD]; get mouseMove=>this[t.oE]; get mouseDown=>this[t.MD]; get mouseUp=>this[t.yD]; get mouseWheel=>this[t.dG]; get touchMove=>this[BC.nE]; get touchEnd=>this[BC.hE]; get touchCancel=>this[BC.jE]; get keyUp=>this[kC.gE]; get keyDown=>this[kC.sD];}class VE{var GK;var YK;var lK;var rK;var zK;var FL;var ML;var QL;var TL;var aL;var gL;VE( g, h){GK=g;YK=h;} get YH=>YK; get name=>GK; get wG=>lK; get xG=>rK; get vG=>zK; get uG=>FL; get offsetX=>ML; get offsetY=>QL; get MH=>TL; get LH=>aL; get UH=>gL;}class tF extends WE{tF( g):super(g);}class sF extends CB{var MK;sF( g):super(CB.wD,false){MK=g;} get CE=>false;}class JD extends w{static const  rD='DIRECTION_UP';static const  iE='DIRECTION_RIGHT';static const  xD='DIRECTION_DOWN';static const  ND='DIRECTION_LEFT';var lL;var oL;var rL;var vL;JD( g,[ direction=ND]){if(direction!=rD&&direction!=xD&&direction!=ND&&direction!=iE){throw new ArgumentError('Invalid Gauge direction!');}lL=direction;oL=1.0;rL=g;vL=new QB.zH();iM();} get ratio=>oL;set ratio( g){if(g<0.0)g=0.0;if(g>1.0)g=1.0;oL=g;iM();} get PB=>rL;set PB( g){rL=g;iM();}iM(){if(rL==null){vL.left=0;vL.top=0;vL.right=0;vL.bottom=0;}else{var h=rL.width;var g=rL.height;switch (lL){case ND:vL.left=((1.0-oL)*h).toInt();vL.top=0;vL.right=h;vL.bottom=g;break;case rD:vL.left=0;vL.top=((1.0-oL)*g).toInt();vL.right=h;vL.bottom=g;break;case iE:vL.left=0;vL.top=0;vL.right=(oL*h).toInt();vL.bottom=g;break;case xD:vL.left=0;vL.top=0;vL.right=h;vL.bottom=(oL*g).toInt();break;}}} tB( h,[ returnRectangle]){var g=(rL!=null)?rL.width:0;var i=(rL!=null)?rL.height:0;return BE(h,g,i,returnRectangle);} QC( g, h){if(rL!=null&&g>=0.0&&h>=0.0&&g<rL.width&&h<rL.height)return this;return null;} oB( g){if(rL!=null)rL.SF(g,vL);}}abstract class HB{static  DG( g){var h=HD.lG;if(h=="WebAudioApi")return kD.DG(g);if(h=="AudioElement")return jD.DG(g);return XE.DG(g);} get length; play([ loop=false, soundTransform]);static var VC;static  tE( g){if(VC==null){VC=new List<String>();var i=new aC.AudioElement();var h=["maybe","probably"];if(h.indexOf(i.canPlayType("audio/ogg",""))!=-1)VC.add("ogg");if(h.indexOf(i.canPlayType("audio/mp3",""))!=-1)VC.add("mp3");if(h.indexOf(i.canPlayType("audio/wav",""))!=-1)VC.add("wav");}var k=new RegExp(r"\.(ogg|mp3|wav)$",multiLine:false,ignoreCase:true);var j=k.firstMatch(g);if(j==null)throw new ArgumentError("Unsupported file extension.");var l=j.group(1).toLowerCase();if(VC.indexOf(l)==-1&&VC.length>0)g="${g.substring(0,g.length-3)}${VC[0]}";return g;}}abstract class IC extends ZB{ get FC; set FC( g); stop();}class VB{var volume;var NH;var sH=1;var tH=0;var xH=1;var wH=0;VB([this.volume=1,this.NH=0]);}class HD{static var PD;static  get QD{if(PD==null){try {PD=new cF.AudioContext();}catch (g){PD=null;}}return PD;}static var xC;static  get lG{if(xC==null){xC=(QD!=null)?"WebAudioApi":"AudioElement";var g=aC.window.navigator.userAgent;if(g.contains("IEMobile"))if(g.contains("9.0"))xC="Mock";if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod"))if(g.contains("OS 3")||g.contains("OS 4")||g.contains("OS 5"))xC="Mock";}return xC;}}class t extends CB{static const  UC="click";static const  OG="doubleClick";static const  MD="mouseDown";static const  yD="mouseUp";static const  oE="mouseMove";static const  OD="mouseOut";static const  pE="mouseOver";static const  dG="mouseWheel";static const  rE="middleClick";static const  gG="middleMouseDown";static const  iG="middleMouseUp";static const  sE="rightClick";static const  jG="rightMouseDown";static const  kG="rightMouseUp";var mM,nM;var oM,pM;var NN;var uL;var LM;var wL;var zL;var RN;var SN;var TN;t( g,[ bubbles=false]):super(g,bubbles){dM(g,bubbles);} dM( g,[ bubbles=false]){super.dM(g,bubbles);mM=nM=0;oM=pM=0;NN=false;uL=false;LM=false;wL=false;zL=false;RN=0;SN=0;TN=0;}set UN( g){mM=g.x;nM=g.y;}set VN( g){oM=g.x;pM=g.y;} get IF=>mM; get JF=>nM; get NC=>NN; get altKey=>uL; get ctrlKey=>wL; get shiftKey=>zL; get zC=>RN;}class ID extends IC{var hK;var UK;var SK;var iK;ID( g, i, h){hK=g;SK=i;iK=h;UK=g.GM(this);UK.loop=SK;this.FC=h;UK.play();} get FC=>iK; set FC( g){iK=g;if(UK!=null)UK.volume=(iK!=null)?iK.volume:1;} stop(){if(UK!=null){if(UK.ended==false)UK.pause();hK.ON(this);UK=null;}}}class kD extends HB{var QK;kD(){if(HD.QD==null)throw new UnsupportedError("This browser does not support Web Audio API.");}static  DG( o){var i=new kD();var g=new Completer<HB>();var h=new aC.HttpRequest(); l( k){i.QK=k;if(g.future.isComplete==false)g.complete(i);} v(IB){if(g.future.isComplete==false)g.completeException("Failed to decode audio.");} EB(s){var m=HD.QD;m.decodeAudioData(h.response,l,v);} j(s){if(g.future.isComplete==false)g.completeException("Failed to load audio.");}h.open('GET',HB.tE(o),true);h.responseType='arraybuffer';h.on.load.add(EB);h.on.error.add(j);h.send();return g.future;} get length{return QK.duration;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new VB();return new hH(this,loop,soundTransform);}}class uF{var name;var wB;var IE;uF(this.name,this.wB,this.IE);}class XE extends HB{XE(){}static  DG( i){var h=new XE();var g=new Completer<HB>();aC.window.setTimeout(()=>g.complete(h),1);return g.future;} get length{return double.NAN;} play([ loop=false, soundTransform]){if(soundTransform==null)soundTransform=new VB();return new gH(this,loop,soundTransform);}}class gH extends IC{var SK;var iK;gH( i, h, g){SK=h;iK=g;} get FC=>iK; set FC( g){iK=g;} stop(){}}class AG{static const  IG="pixel";}class JC extends lB{var TK="";var cK=0x000000;var xK=null;var KL=wF.NG;var WL=AG.IG;var AK=yF.CG;var kL=false;var pL=false;var tL=0x000000;var yL=false;var CM=0x000000;var IM=0;var MM=0;var RM;var VM;var WM=true;var ZM=100;var cM=100;var fM=null;var NK=null;JC(){xK=new cE("Arial",12,0x000000);RM=new List<String>();VM=new List<lD>();} get type=>AK; get width=>ZM; get height=>cM; set text( g){TK=g;WM=true;} set OC( g){xK=g;cK=xK.color;WM=true;} set wordWrap( g){kL=g;WM=true;} set width( g){ZM=g;WM=true;} set height( g){cM=g;WM=true;} get XH{bN();return IM;} get JE{bN();return MM;} tB( g,[ returnRectangle]){return BE(g,ZM,cM,returnRectangle);} QC( g, h){if(g>=0&&h>=0&&g<ZM&&h<cM)return this;return null;} oB( g){bN();g.NK.drawImage(fM,0.0,0.0);} fN(){RM.clear();VM.clear();if(kL==false){RM.add(TK);}else{var g=new StringBuffer();var i;var h;for(String j in TK.split(" ")){i=g.length;g.add((i>0)?" ${j}":j);h=g.toString();if(NK.measureText(h).width>ZM){if(i>0)h=h.substring(0,i);else j="";RM.add(h);g.clear();g.add(j);}}if(g.isEmpty==false)RM.add(g.toString());}IM=0;MM=0;for(String h in RM){var l=NK.measureText(h);var m=0;if(xK.align==qB.KC||xK.align==qB.RG)m=(ZM-l.width)/2;if(xK.align==qB.PG||xK.align==qB.LG)m=ZM-l.width;var k=new lD(m,l.width,xK.size,0,0,0);VM.add(k);IM=SB.max(IM,k.width);MM=MM+k.height;}} bN(){if(WM){WM=false;var i=ZM.ceil().toInt();var j=cM.ceil().toInt();if(fM==null){fM=new aC.CanvasElement(width:i,height:j);NK=fM.context2d;}if(fM.width!=i)fM.width=i;if(fM.height!=j)fM.height=j;var g=new StringBuffer();g.add(xK.HF?"italic ":"normal ");g.add("normal ");g.add(xK.DC?"bold ":"normal ");g.add("${xK.size}px ");g.add("${xK.font},sans-serif");NK.font=g.toString();NK.textAlign="start";NK.textBaseline="top";NK.fillStyle=vC(cK);fN();if(pL){NK.fillStyle=vC(tL);NK.fillRect(0,0,ZM,cM);}else{NK.clearRect(0,0,ZM,cM);}var k=0;for(int h=0;h<RM.length;h++ ){var l=VM[h];NK.fillStyle=vC(cK);NK.fillText(RM[h],l.x,k);k+= l.height;}if(yL){NK.strokeStyle=vC(CM);NK.lineWidth=1;NK.strokeRect(0,0,ZM,cM);}}}}class wF{static const  NG="none";}class yF{static const  CG="dynamic";}class cE{var font;var size;var color;var DC;var HF;var aH;var align;var HH;var TH;var BH;var FE;var letterSpacing=0;var jH=0;var kH=false;var rH=false;cE(this.font,this.size,this.color,{this.DC: false,this.HF: false,this.aH: false,this.align: "left",this.HH: 0,this.TH: 0,this.BH: 0,this.FE: 0});}class kC extends CB{static const  sD="keyDown";static const  gE="keyUp";var uL;var wL;var zL;var DM;var LM;var PM;var SM;var UM;kC( g,[ bubbles=false]):super(g,bubbles){dM(g,bubbles);} dM( g,[ bubbles=false]){super.dM(g,bubbles);uL=false;wL=false;zL=false;DM=false;LM=false;PM=0;SM=0;UM=0;} get altKey=>uL; get ctrlKey=>wL; get shiftKey=>zL; get charCode=>PM; get keyCode=>SM; get keyLocation=>UM;}class lD{var rG;var sG;var height;var FE;var width;var x;lD(this.x,this.width,this.height,this.rG,this.sG,this.FE);}class ZE extends CB{static const  MG="textInput";var TK="";ZE( g,[ bubbles=false]):super(g,bubbles){}}class qB{static const  KC="center";static const  LG="end";static const  RG="justify";static const  PG="right";}class rB{static const  pD="auto";static const  tD="arrow";static const  uD="button";static const  VG="hand";static const  WG="ibeam";static const  YG="wait";}class BC extends CB{static const  fE="touchBegin";static const  hE="touchEnd";static const  jE="touchCancel";static const  nE="touchMove";static const  ZG="touchOver";static const  aG="touchOut";var hM;var jM;var mM,nM;var oM,pM;var uL;var LM;var wL;var zL;var rM;var tM;var uM;BC( g,[ bubbles=false]):super(g,bubbles){dM(g,bubbles);} dM( g,[ bubbles=false]){super.dM(g,bubbles);hM=0;jM=false;mM=nM=0;oM=pM=0;uL=false;LM=false;wL=false;zL=false;rM=1.00;tM=0;uM=0;}set UN( g){mM=g.x;nM=g.y;}set VN( g){oM=g.x;pM=g.y;} get ZD=>hM; get IF=>mM; get JF=>nM; get altKey=>uL; get ctrlKey=>wL; get shiftKey=>zL;}class mD implements kB{var WK;var jK;var uK;mD(){uK=0.0;WK=new List<kB>();jK=0;} add( g){if(g==null)return;if(jK>=WK.length)WK.add(g);else WK[jK]=g;jK++ ;} remove( h){if(h==null)return;for(int g=0;g<jK;g++ )if(WK[g]==h)WK[g]=null;} fB( h, i){var g=new iD(h,i);add(g);return g;} CC( j){uK+= j;var k=jK;var h=0;for(int g=0;g<k;g++ ){var i=WK[g];if(i!=null&&i.CC(j)){if(h!=g)WK[h]=i;h++ ;}}for(int g=k;g<jK;g++ )WK[h++ ]=WK[g];for(int g=h;g<jK;g++ )WK[g]=null;jK=h;return true;}}class nD{static var dE=rB.pD;static var HG=false;static var SG=new ZB();static  uE( i){var h=i;var g="auto";if(dE!=rB.pD)h=dE;switch (h){case rB.pD:g="auto";break;case rB.tD:g="default";break;case rB.uD:g="pointer";break;case rB.VG:g="move";break;case rB.WG:g="text";break;case rB.YG:g="wait";break;}if(HG)g="none";return g;}}class hC{var LK;var eK;var AL;var LL;var SL;var YL;var dL;hC(){LK=new Map<String,DB>();eK=new Map<String,HB>();AL=new Map<String,aB>();LL=new Map<String,String>();SL=null;YL=0;dL=0;} hB( h, i){var g=DB.wE(i);YL++ ;g.then(( j){LK[h]=j;YL-- ;zM();});g.handleException((k){dL++ ;YL-- ;zM();});} bB( h, i){var g=HB.DG(i);YL++ ;g.then(( j){eK[h]=j;YL-- ;zM();});g.handleException((k){dL++ ;YL-- ;zM();});} yC( i, k, h){var g=aB.bG(k,h);YL++ ;g.then(( j){AL[i]=j;YL-- ;zM();});g.handleException((l){dL++ ;YL-- ;zM();});} nB( h, g){LL[h]=g;} load(){SL=new Completer<hC>();zM();return SL.future;} q( g){if(LK.containsKey(g)==false)throw new ArgumentError("Resource not found: '${g}'");return LK[g];} iB( g){if(eK.containsKey(g)==false)throw new ArgumentError("Resource not found: '${g}'");return eK[g];} PC( g){if(AL.containsKey(g)==false)throw new ArgumentError("Resource not found: '${g}'");return AL[g];} pC( g){if(LL.containsKey(g)==false)return "[[${g}]]";return LL[g];}zM(){if(SL!=null&&YL==0){if(dL==0)SL.complete(this);else SL.completeException(this);}}}class aB{var HK;var kK;aB(){HK=new aC.ImageElement();kK=new List<VE>();}static  bG( o, RB){var m=new Completer<aB>();var i=new aB();switch (RB){case dC.EG:case dC.nC:var k=new aC.HttpRequest();k.open('GET',o,true);k.on.load.add((pB){ s( l, g){var EB=nG(l);var h=new VE(EB,i);h.lK=g["frame"]["x"].toInt();h.rK=g["frame"]["y"].toInt();h.zK=g["frame"]["w"].toInt();h.FL=g["frame"]["h"].toInt();h.ML=g["spriteSourceSize"]["x"].toInt();h.QL=g["spriteSourceSize"]["y"].toInt();h.TL=g["sourceSize"]["w"].toInt();h.aL=g["sourceSize"]["h"].toInt();h.gL=g["rotated"] as bool;i.kK.add(h);}var v=cH.JSON.parse(k.responseText);var j=v["frames"];var IB=v["meta"];if(j is List)for(var g in j)s(g["filename"],g);if(j is Map)for(String l in j.qH())s(l,j[l]);i.HK.on.load.add((gB)=>m.complete(i));i.HK.on.error.add((gB)=>m.completeException("Failed to load image."));i.HK.src=oG(o,IB["image"]);});k.on.error.add((pB)=>m.completeException("Failed to load json file."));k.send();break;}return m.future;} get AH=>HK; q( i){var h;for(int g=0;g<kK.length&&h==null;g++ )if(kK[g].name==i)h=new DB.EI(kK[g]);if(h==null)throw new ArgumentError("TextureAtlasFrame not found: '${i}'");return h;}static  nG( g){var h=new RegExp(r"(.+?)(\.[^.]*$|$)",multiLine:false,ignoreCase:true);var i=h.firstMatch(g);return i.group(1);}static  oG( j, g){var i=new RegExp(r"^(.*/)?(?:$|(.+?)(?:(\.[^.]*$)|$))",multiLine:false,ignoreCase:true);var k=i.firstMatch(j);var h=k.group(1);return (h==null)?g:"${h}${g}";}}class iC{static const  BG=0;static const  GG=1;static const  PG=2;static const  UG=3;static const  lE=4;}class hH extends IC{var dK;var iK;var SK;var NL;var VL;hH( j, h, i){dK=j;SK=h;iK=i;var g=HD.QD;NL=g.createGain();NL.connect(g.destination,0,0);NL.gain.value=(iK!=null)?SB.pow(iK.volume,2):1;VL=g.createBufferSource();VL.buffer=dK.QK;VL.loop=h;VL.connect(NL,0,0);VL.start(0);} get FC=>iK; set FC( g){iK=g;NL.gain.value=(iK!=null)?SB.pow(iK.volume,2):1;} stop(){VL.stop(0);}}class oD extends JD implements kB{static const  JG='TIME_OUT';var PL=false;var OK=0.0;var gK=0.0;var iL;var mL=true;oD( g, h,[ direction=JD.ND]):super(h,direction){if(g<=0)throw new ArgumentError('Time must be greater than zero');gK=g;AF();} CC( g){if(PL&&ratio>0.0){ratio=ratio-g/totalTime;if(ratio==0.0)pause();}return true;} start(){PL=true;} pause(){PL=false;} reset([ time=0.0]){pause();time=SB.max(time,0.0);if(time!=0.0){gK=time;AF();}ratio=1.0;} RD( g, h){iL[g]=h/totalTime;} AF(){iL=new Map<String,num>();RD(oD.JG,0);} get totalTime=>gK; get SH=>ratio*totalTime; set ratio( i){var h=ratio;super.ratio=i;if(mL){iL.forEach((j,g){if(g<h&&g>=ratio)KB(new CB(j));});}}}class DB implements aE{var VK;var bK;var oK;var BL;var NK;var RL;var XL;var bL;var lK;var rK;var zK;var FL;DB( g, h,[ transparent=true, fillColor=0xFFFFFFFF]){VK=g;bK=h;oK=transparent;var i=new aC.CanvasElement(width:VK,height:bK);NK=i.context2d;NK.fillStyle=oK?cG(fillColor):vC(fillColor);NK.fillRect(0,0,g,h);BL=i;RL=0;}DB.DI( g){VK=g.naturalWidth;bK=g.naturalHeight;oK=true;BL=g;RL=0;}DB.EI( g){VK=g.MH;bK=g.LH;oK=true;BL=g.YH.AH;RL=g.UH?2:1;XL=g.offsetX.toDouble();bL=g.offsetY.toDouble();lK=g.wG.toDouble();rK=g.xG.toDouble();zK=g.vG.toDouble();FL=g.uG.toDouble();}static  wE( i){var h=new Completer<DB>();var g=new aC.ImageElement();g.on.load.add((j)=>h.complete(new DB.DI(g)));g.on.error.add((j)=>h.completeException("Failed to load image."));g.src=i;return h.future;} get width=>VK; get height=>bK; oB( g){switch (RL){case 0:g.context.drawImage(BL,0.0,0.0);break;case 1:g.context.drawImage(BL,lK,rK,zK,FL,XL,bL,zK,FL);break;case 2:g.context.transform(0.0,-1.0,1.0,0.0,XL,bL+FL);g.context.drawImage(BL,lK,rK,FL,zK,0.0,0.0,FL,zK);break;}} SF( gB, g){if(g.width<=0.0||g.height<=0.0)return;switch (RL){case 0:gB.context.drawImage(BL,g.x,g.y,g.width,g.height,g.x,g.y,g.width,g.height);break;case 1:double j=lK;double h=rK;double v=j+zK;double EB=h+FL;double l=lK-XL+g.x;double m=rK-bL+g.y;double RB=l+g.width;double IB=m+g.height;double s=(j>l)?j:l;double o=(h>m)?h:m;double pB=(v<RB)?v:RB;double ME=(EB<IB)?EB:IB;double NE=XL-j+s;double ZC=bL-h+o;double k=pB-s;double i=ME-o;if(k>0.0&&i>0.0){gB.context.drawImage(BL,s,o,k,i,NE,ZC,k,i);}break;case 2:double j=lK;double h=rK;double v=j+FL;double EB=h+zK;double l=lK+bL-g.y+FL-g.height;double m=rK-XL+g.x;double RB=l+g.height;double IB=m+g.width;double s=(j>l)?j:l;double o=(h>m)?h:m;double pB=(v<RB)?v:RB;double ME=(EB<IB)?EB:IB;double NE=XL-h+o;double ZC=bL+v-pB;double k=ME-o;double i=pB-s;if(k>0.0&&i>0.0){gB.context.transform(0.0,-1.0,1.0,0.0,NE,ZC+i);gB.context.drawImage(BL,s,o,i,k,0.0,0.0,i,k);}break;}}}typedef  mC(event); vC( g){var h=(g>>16)&0xFF;var i=(g>>8)&0xFF;var j=(g>>0)&0xFF;return "rgb(${h},${i},${j})";}class kE{static var mE=false;static var zD=false;static var AE=0;static var fG=bE.NG;static var SG=new ZB();static hG(){if(mE==false){mE=true;var g=aC.window.navigator.userAgent;if(g.contains("iPhone")||g.contains("iPad")||g.contains("iPod")){zD=true;AE=10;}if(g.contains("Android")){zD=true;AE=10;}if(g.contains("IEMobile")){zD=true;AE=10;}}}static  get mG{hG();return fG;}}class LC extends kB{var xL;var AM;var FM;var HM;var NM;var OM;var TM;var gK;var OK;var XM;var YM;var aM;LC( g, h, i,[ transitionType( ratio)]){xL=g;AM=h;FM=g;HM=(transitionType!=null)?transitionType:MB.MC;OK=0.0;gK=SB.max(0.0001,i);XM=0.0;YM=false;aM=false;} CC( i){if(OK<gK||aM==false){OK=OK+i;if(OK>gK)OK=gK;if(OK>=0.0){if(aM==false){aM=true;if(NM!=null)NM();}var g=OK/gK;var h=HM(g);FM=xL+h*(AM-xL);if(OM!=null)OM(YM?FM.round():FM);if(TM!=null&&OK==gK)TM();}}return OK<gK;} get wB=>xL; get IE=>AM; get totalTime=>gK; get currentTime=>OK; get isComplete=>OK>=gK;set delay( g){if(aM==false)OK=OK+XM-g;XM=g;} set PF( g()){NM=g;} set HC( g( value)){OM=g;} set onComplete( g()){TM=g;}}class TB{var SG;var KM;var QM;TB( h, g){SG=h;KM=g;QM=new List<zF>();} get GF=>SG; add( h,[ useCapture=false]){for(int g=0;g<QM.length;g++ )if(QM[g].UD==h&&QM[g].aD==useCapture)return;if(KM==CB.wD&&QM.length==0)KD.qD.add(this);QM.add(new zF(h,useCapture));} remove( h,[ useCapture=false]){for(int g=0;g<QM.length;g++ ){if(QM[g].UD==h&&QM[g].aD==useCapture){QM=new List<zF>.from(QM);QM.removeAt(g);if(KM==CB.wD&&QM.length==0)KD.qD.remove(this);break;}}} operator+( g){this.add(g,false);} operator-( g){this.remove(g,false);} KB( h){for(int g=0;g<QM.length;g++ )if(h.eventPhase!=eC.eE||QM[g].aD)if(h.WH==false)QM[g].UD(h);}}class qE{static var eG=0;var ZD=eG++ ;var target=null;var XD=false;qE(this.target,this.XD);} cG( g){var h=(g>>24)&0xFF;var i=(g>>16)&0xFF;var j=(g>>8)&0xFF;var k=(g>>0)&0xFF;return "rgba(${i},${j},${k},${h/255.0})";}class MB{static  MC( g){return g;}static  vE( g){return g*g*g;}static  sB( g){g=1.0-g;return 1.0-g*g*g;}static  pG( g){if(g==0.0||g==1.0)return g;return SB.pow(2.0,-10.0*g)*SB.sin((g-0.3/4.0)*(2.0*SB.PI)/0.3)+1;}}class mB implements kB{var gM;var HM;var kM;var NM;var OM;var TM;var gK;var OK;var XM;var YM;var aM;mB( g, h,[ transitionType( ratio)]){gM=g;HM=(transitionType!=null)?transitionType:MB.MC;OK=0.0;gK=SB.max(0.0001,h);XM=0.0;YM=false;aM=false;kM=new List<uF>();} WB( g, h){var i=['x','y','pivotX','pivotY','scaleX','scaleY','rotation','alpha'];if(i.indexOf(g)==-1)throw new ArgumentError("Error #9003: The supplied property ('${g}') is not supported at this time.");if(gM!=null&&aM==false)kM.add(new uF(g,0.0,h));} moveTo( h, g){WB('x',h);WB('y',g);} CC( l){if(OK<gK||aM==false){OK=OK+l;if(OK>gK)OK=gK;if(OK>=0.0){if(aM==false){aM=true;for(int i=0;i<kM.length;i++ ){var g=kM[i];switch (g.name){case 'x':g.wB=gM.x;break;case 'y':g.wB=gM.y;break;case 'pivotX':g.wB=gM.RC;break;case 'pivotY':g.wB=gM.SC;break;case 'scaleX':g.wB=gM.vB;break;case 'scaleY':g.wB=gM.EC;break;case 'rotation':g.wB=gM.XB;break;case 'alpha':g.wB=gM.alpha;break;}}if(NM!=null)NM();}var j=OK/gK;var k=HM(j);for(int i=0;i<kM.length;i++ ){var g=kM[i];var h=g.wB+k*(g.IE-g.wB);h=YM?h.round():h;switch (g.name){case 'x':gM.x=h;break;case 'y':gM.y=h;break;case 'pivotX':gM.RC=h;break;case 'pivotY':gM.SC=h;break;case 'scaleX':gM.vB=h;break;case 'scaleY':gM.EC=h;break;case 'rotation':gM.XB=h;break;case 'alpha':gM.alpha=h;break;}}if(OM!=null)OM();if(TM!=null&&OK==gK)TM();}}return OK<gK;} get totalTime=>gK; get currentTime=>OK; get isComplete=>OK>=gK;set delay( g){if(aM==false)OK=OK+XM-g;XM=g;} set PF( g()){NM=g;} set HC( g()){OM=g;} set onComplete( g()){TM=g;}}class oC extends jC{var fM;var NK;var qM;var sM;var wM;var yM;var BN;var EN;var HN;var JN;var KN;var LN;var MN;var PN;var QN;oC( h, g){GK=h;fM=g;fM.focus();NK=g.context2d;sM=new AC.BI(NK);wM=lC.pD;yM=rB.tD;nD.SG.addEventListener("mouseCursorChanged",WN);HN=[new YE(t.MD,t.yD,t.UC,t.OG),new YE(t.gG,t.iG,t.rE,t.rE),new YE(t.jG,t.kG,t.sE,t.sE)];EN=null;BN=new NB(0,0);KN=new t(t.UC,true);PN=BM;fM.on..mouseDown.add(PN)..mouseUp.add(PN)..mouseMove.add(PN)..mouseOut.add(PN)..mouseWheel.add(PN);JN=new Map<int,qE>();MN=new BC(BC.fE,true);QN=ZN;kE.SG.addEventListener("inputModeChanged",aN);aN(null);LN=new kC(kC.sD,true);fM.on.keyDown.add(cN);fM.on.keyUp.add(cN);fM.on.keyPress.add(dN);} get focus=>qM; set RH( g){wM=g;} eN(){throw new UnsupportedError("Error #2071: The Stage class does not implement this property or method.");} set x( g){eN();} set y( g){eN();} set RC( g){eN();} set SC( g){eN();} set vB( g){eN();} set EC( g){eN();} set XB( g){eN();} set alpha( g){eN();} set width( g){eN();} set height( g){eN();} IH(){if(wM==lC.pD||wM==lC.vD){sM.reset();oB(sM);if(wM==lC.vD)wM=lC.KG;}} WN( g){fM.style.cursor=nD.uE(yM);} BM( j){j.preventDefault();var IB=fM.getBoundingClientRect();var o=new Date.now().millisecondsSinceEpoch;var v=j.button;var h=null;var i=new NB(j.clientX-IB.left,j.clientY-IB.top);var m=null;if(v<0||v>2)return;if(j.type=="mousemove"&&BN.equals(i))return;var g=HN[v];BN=i;if(j.type!="mouseout")h=QC(i.x,i.y) as lB;var k=rB.tD;if(h is AB)if(h.LE)k=rB.uD;if(h is tC)if(h.LE)k=rB.uD;if(yM!=k){yM=k;fM.style.cursor=nD.uE(k);}if(EN!=null&&EN!=h){EN.KB(KN..dM(t.OD,true)..UN=(EN.YD!=null)?EN.qC(i):new NB.zH()..VN=i..NN=g.NC);EN=null;}if(h!=null&&h!=EN){h.KB(KN..dM(t.pE,true)..UN=h.qC(i)..VN=i..NN=g.NC);EN=h;}var l=null;var s=false;var EB=false;if(j.type=="mousedown"){l=g.MF;if(h!=g.target||o>g.DE+500)g.zC=0;g.NC=true;g.target=h;g.DE=o;g.zC++ ;}if(j.type=="mouseup"){l=g.NF;g.NC=false;s=(g.target==h);EB=s&&g.zC.isEven&&(o<g.DE+500);}if(j.type=="mousemove"){l=t.oE;}if(l!=null&&h!=null){m=h.qC(i);h.KB(KN..dM(l,true)..UN=m..VN=i..NN=g.NC..RN=g.zC);if(s){if(EB&&h.tG){h.KB(KN..dM(g.LF,true)..UN=m..VN=i..NN=g.NC);}else{h.KB(KN..dM(g.KF,true)..UN=m..VN=i..NN=g.NC);}}}} aN( g){fM.on..touchStart.remove(QN)..touchEnd.remove(QN)..touchMove.remove(QN)..touchEnter.remove(QN)..touchLeave.remove(QN)..touchCancel.remove(QN);if(kE.mG==bE.TG){fM.on..touchStart.add(QN)..touchEnd.add(QN)..touchMove.add(QN)..touchEnter.add(QN)..touchLeave.add(QN)..touchCancel.add(QN);}} ZN( j){j.preventDefault();var o=fM.getBoundingClientRect();for(var m in j.changedTouches){var l=m.identifier;var h=null;var i=new NB(m.clientX-o.left,m.clientY-o.top);var s=null;h=QC(i.x,i.y) as lB;var g=JN.containsKey(l)?JN[l]:new qE(h,JN.length==0);if(g.target!=null&&g.target!=h){g.target.KB(MN..dM(BC.aG,true)..UN=(g.target.YD!=null)?g.target.qC(i):new NB.zH()..VN=i..hM=g.ZD..jM=g.XD);g.target=null;}if(h!=null&&h!=g.target){h.KB(MN..dM(BC.ZG,true)..UN=h.qC(i)..VN=i..hM=g.ZD..jM=g.XD);g.target=h;}var k=null;if(j.type=="touchstart"){JN[l]=g;k=BC.fE;}if(j.type=="touchend"){JN.remove(l);k=BC.hE;}if(j.type=="touchcancel"){JN.remove(l);k=BC.jE;}if(j.type=="touchmove"){k=BC.nE;}if(k!=null&&h!=null){h.KB(MN..dM(k,true)..UN=h.qC(i)..VN=i..hM=g.ZD..jM=g.XD);}}} cN( g){g.preventDefault();var h=null;if(g.type=="keyup")h=kC.gE;if(g.type=="keydown")h=kC.sD;LN..dM(h,true)..uL=g.altKey..wL=g.ctrlKey..zL=g.shiftKey..PM=g.charCode..SM=g.keyCode..UM=iC.BG;if(g.keyLocation==aC.KeyLocation.LEFT)LN.UM=iC.GG;if(g.keyLocation==aC.KeyLocation.RIGHT)LN.UM=iC.PG;if(g.keyLocation==aC.KeyLocation.NUMPAD)LN.UM=iC.UG;if(g.keyLocation==aC.KeyLocation.JOYSTICK)LN.UM=iC.lE;if(g.keyLocation==aC.KeyLocation.MOBILE)LN.UM=iC.lE;if(qM!=null)qM.KB(LN);} dN( g){var i=(g.charCode!=0)?g.charCode:g.keyCode;var h=new ZE(ZE.MG,true);h.TK=new String.fromCharCodes([i]);if(qM!=null)qM.KB(h);}} BE( g, m, EB, j){var ZC=0.0;var pB=0.0;var v=m*g.a;var gB=m*g.b;var IB=m*g.a+EB*g.c;var s=m*g.b+EB*g.d;var RB=EB*g.c;var o=EB*g.d;var h=ZC;if(h>v)h=v;if(h>IB)h=IB;if(h>RB)h=RB;var i=pB;if(i>gB)i=gB;if(i>s)i=s;if(i>o)i=o;var l=ZC;if(l<v)l=v;if(l<IB)l=IB;if(l<RB)l=RB;var k=pB;if(k<gB)k=gB;if(k<s)k=s;if(k<o)k=o;if(j==null)j=new QB.zH();j.x=g.XC+h;j.y=g.YC+i;j.width=l-h;j.height=k-i;return j;}
//@ sourceMappingURL=escape.dart.map